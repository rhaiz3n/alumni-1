



<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>HOME | TUP - Cavite</title>

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Alegreya:wght@400;500;700&family=Albert+Sans:wght@400;500;700&family=Sanchez&display=swap" rel="stylesheet">

  <!-- Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />

  <link rel="icon" type="image/png" href="/Logo2.png">

  <style>
    /* Minimal custom styles to get a FB-like feel */
    body { font-family: "Albert Sans", Arial, sans-serif; background:#e0e0e0; }
    .left-col { min-width: 220px; max-width: 270px; position: sticky; top: 80px; height: calc(100vh - 100px); overflow-y: auto;}
    .right-col { min-width: 260px; max-width: 320px; position: sticky; top: 80px; height: calc(100vh - 100px); overflow-y: auto; }
    .feed-card {
      background: #fff;
      border-radius: 10px;
      padding: 16px;
      margin-bottom: 20px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
      border: 1px solid #e0e0e0;
    }

    .feed-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 12px;
    }

    .feed-header-left {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .feed-header img {
      width: 48px;
      height: 48px;
      object-fit: cover;
      border-radius: 50%;
      border: 2px solid #d8d8d8;
    }

    .feed-header strong {
      font-size: 15px;
    }

    .feed-badges span {
      font-size: 12px;
      font-weight: 600;
      padding: 3px 8px;
      border-radius: 12px;
      margin-left: 6px;
    }

    .badge-career {
      background-color: #198754;
      color: #fff;
    }

    .badge-active {
      background-color: #0d6efd;
      color: #fff;
    }

    .feed-img {
      width: 100%;
      height: 320px;
      object-fit: cover;
      border-radius: 10px;
      margin-bottom: 12px;
      border: 3px solid #000000;
    }

    .feed-title {
      font-weight: 700;
      margin-bottom: 6px;
      font-size: 16px;
    }

    .feed-desc {
      font-size: 14px;
      color: #444;
      margin-bottom: 10px;
    }

    .feed-company {
      font-size: 13px;
      color: #6c757d;
      margin-bottom: 8px;
    }

    .feed-footer {
      display: flex;
      align-items: center;
      justify-content: flex-end;
      font-size: 13px;
      color: #6c757d;
      gap: 5px;
    }

    .profile-pic-sm1 { width:80px; height:80px; object-fit:cover; border-radius:50%; border: 2px solid #000000;}
    .profile-pic-sm { width:40px; height:40px; object-fit:cover; border-radius:50%; border: 2px solid #000000;}
    .sidebar-link { display:flex; align-items:center; gap:.75rem; padding:.5rem .25rem; border-radius:8px; color:#111; text-decoration:none; }
    .sidebar-link:hover { background:#e9ecef; text-decoration:none; }
    .badge-custom { background: #e9ecef; color:#333; padding:.25rem .5rem; border-radius: .5rem; font-size: .72rem; }
    #toast-container { position: fixed; right: 20px; top: 80px; z-index: 2000; display:flex; flex-direction:column; gap:8px; }
    .toast { padding:10px 14px; color:#fff; border-radius:6px; box-shadow: 0 4px 10px rgba(0,0,0,.12); opacity: .98; }
    .toast.info { background:#0dcaf0; }
    .toast.success { background:#28a745; }
    .toast.error { background:#dc3545; }
    .toast.warning { background:#ffc107; color:#000; }
    .countdown { font-weight:600; color:#555; }
    .profile-card { display:flex; gap:1rem; align-items:center; }
    .applications-table { width:100%; border-collapse: collapse; }
    .applications-table th, .applications-table td { padding:.5rem; border-bottom:1px solid #eee; text-align:left; }
    .modal-body .form-label { font-weight:600; }
    .register-btn { margin-top: 8px; }
    .badge-pending {
      background-color: orange;
      color: white;
    }
    /* Responsive */
    @media (max-width: 991px) {
      .left-col, .right-col { display:none; }
    }
    main.col-lg-6 {
      margin: 0 auto;
    }
    .navbar {
      position: sticky;
      top: 0;        /* sticks to the top */
      z-index: 1050; /* ensures it's above other content */
    }
    nav.flex-column {
      position: sticky;
      top: 80px; /* distance from top (below navbar) */
      max-height: calc(100vh - 100px); 
      overflow-y: auto; /* add scrolling if items overflow */
      background: #fff; 
      padding: 12px;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
    }
  </style>
</head>
<body>


 <!-- NAVBAR -->
    <nav class="navbar navbar-expand-lg navbar-light border-bottom" style="background: linear-gradient(175deg, #882323 55%, #000000 60%);">
    <div class="container-fluid">
      <a class="navbar-brand d-flex align-items-center gap-2" href="user-homepage.html">
        <img src="Logo.png" alt="logo" width="38" height="38">
        <strong>TUPC Cavite</strong>
      </a>

      <!-- toggler for mobile -->
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNavbar"
              aria-controls="mainNavbar" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <!-- collapse area -->
      <div class="collapse navbar-collapse" id="mainNavbar">
        <!-- left placeholder (keeps symmetrical spacing when search is centered) -->
        <div class="d-flex align-items-center"></div>

        <!-- CENTERED SEARCH (absolute on lg+, static and stacked on mobile) -->
      <form class="d-flex center-search w-50" role="search" onsubmit="return false;">
        <input id="feedSearch" class="form-control me-2" type="search"
              placeholder="üîç Search events or careers..." oninput="filterFeed()">
      </form>

        <!-- Right-side actions -->
        <div class="d-flex align-items-center nav-actions ms-auto">
          <button id="galleryBtn" class="btn btn-outline-secondary btn-sm" style="margin-right:10px;">Gallery</button>

          <button id="signOutBtn" class="btn btn-outline-danger btn-sm">Sign Out</button>

          <div class="dropdown ms-2">
            <a class="d-flex align-items-center text-decoration-none dropdown-toggle" href="#"
               data-bs-toggle="dropdown" aria-expanded="false">
              <img id="profilePicSmall" src="/public/images/default-profile.png" alt="profile" class="profile-pic-sm">
              <span id="displayName" class="ms-2 d-none d-lg-inline" style="color: white;">GUEST</span>
            </a>
            <ul class="dropdown-menu dropdown-menu-end">
              <li><a class="dropdown-item" href="#" id="openProfileMenu">View Profile</a></li>
              <li><a class="dropdown-item" href="#" id="viewApplicationsBtnSidebar">My Applications</a></li>
              <li><hr class="dropdown-divider"></li>
              <li><a class="dropdown-item" href="#" id="openIdRequestBtn">ID Request</a></li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </nav>

<!-- MAIN LAYOUT -->
<div class="container mt-3">
  <div class="row gx-4">
    
    <!-- LEFT SIDEBAR -->
    <aside class="col-lg-3 left-col">
      <div class="card mb-3">
        <div class="card-body">
          <div class="profile-card d-flex align-items-center">
            <img id="profilePic" src="/public/images/default-profile.png" alt="profile" class="profile-pic-sm1 me-2">
            <div>
              <h6 id="nameTop" class="mb-0">NAME</h6>
              <small id="userNameTop">Username</small>
            </div>
          </div>
          <hr>
          <nav class="nav flex-column">
            <a class="sidebar-link" href="user-homepage.html"><i class="bi bi-house"></i> Home</a>
            <a class="sidebar-link" href="#" id="openApplicationsFromSidebar"><i class="bi bi-journal-text"></i> My Applications</a>
            <a class="sidebar-link" href="#" id="openIdStatusSidebar"><i class="bi bi-credit-card"></i> ID Request Status</a>
            <a class="sidebar-link" href="gallery-user.html?from=user-homepage.html"><i class="bi bi-image"></i> Gallery</a>

            <div id="fullSurveyCountdownBox" style="display:none;">
              ‚è≥ Full Survey available in <span id="fullSurveyCountdown"></span>
            </div>
            <div id="miniSurveyCountdownBox" style="display:none;">
              ‚è≥ Mini Survey available in <span id="miniSurveyCountdown"></span>
            </div>
          </nav>
        </div>
      </div>

      <div class="card">
        <div class="card-body">
          <h6 class="mb-2">ID Announcements</h6>
          <div id="idAnnouncementList">Loading...</div>
        </div>
      </div>
    </aside>

    <!-- CENTER FEED -->
    <div class="col-lg-6">
      <div id="feed">
        <!-- feed cards go here -->
      </div>
    </div>

    <!-- RIGHT SIDEBAR -->
    <aside class="col-lg-3 right-col">
      <div class="card mb-3">
        <div class="card-body">
          <h6>Events Announcements</h6>
          <div id="eventList">Loading...</div>
        </div>
      </div>

      <div class="card">
        <div class="card-body">
          <h6>Career Opportunities</h6>
          <div id="careerList">Loading...</div>
        </div>
      </div>
    </aside>

  </div>
</div>


  <!-- Toast container -->
  <div id="toast-container" style="position: fixed; top: 80px; right: 20px; z-index: 2000; display: flex; flex-direction: column; gap: 8px;"></div>

  <!-- ID REQUEST STATUS MODAL -->
  <div class="modal fade" id="idStatusModalBS" tabindex="-1" aria-labelledby="idStatusModalLabel">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="idStatusModalLabel">üìå ID Request Status</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body" id="idRequestStatusContent">
          Loading status...
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
</div>



  <!-- PROFILE MODAL -->
  <div class="modal fade" id="modalProfile" tabindex="-1" aria-labelledby="modalProfileLabel">
    <div class="modal-dialog modal-lg modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Profile</h5>
        </div>
        <div class="modal-body">
          <div class="d-flex gap-3">
            <div>
              <img id="modalProfilePic" src="/public/images/default-profile.png" alt="profile" class="rounded-circle" width="120" height="120">
              <div class="mt-2">
                <button id="changePicBtn" type="button" class="btn btn-sm btn-outline-primary mt-2">Change Picture</button>
                <input type="file" id="uploadProfilePic" accept="image/*" style="display:none;">
              </div>
            </div>
            <div class="flex-grow-1">
              <h4 id="name">NAME</h4>
              <p><strong>FULL NAME:</strong> <span id="userName">-</span></p>
              <p>
                <strong>Email:</strong> <span id="personalEmail">-</span>
                <input id="editPersonalEmail" class="form-control form-control-sm mt-1" style="display:none; width: 60%;">
              </p>
              <p>
                <strong>Phone:</strong> <span id="phoneNo">-</span>
                <input id="editPhoneNo" class="form-control form-control-sm mt-1" style="display:none; width: 60%;">
              </p>

              <div class="mt-3">
                <button id="editBtn" class="btn btn-sm btn-outline-secondary">Edit</button>
                <button id="saveBtn" class="btn btn-sm btn-primary" style="display:none;">Save</button>
                <button id="confirmProfileBtn" class="btn btn-sm btn-success" style="display:none;">Confirm Profile</button>
                <div id="profileNotice" class="mt-2 text-warning" style="display:none;"></div>
              </div>
            </div>
          </div>

          <hr>

          <div>
            <h6>Extra Details</h6>
            <p><strong>Gender:</strong> <span id="gender">-</span></p>
            <p><strong>Date of Birth:</strong> <span id="dateBirth">-</span></p>
            <p><strong>Major:</strong> <span id="major">-</span></p>
            <p><strong>Year Started:</strong> <span id="yearStarted">-</span></p>
            <p><strong>Graduated:</strong> <span id="graduated">-</span></p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- APPLICATIONS MODAL -->
  <div class="modal fade" id="applicationsModalBS" tabindex="-1" aria-labelledby="applicationsModalLabel">
    <div class="modal-dialog modal-xl modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">My Applications</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <table class="applications-table">
            <thead>
              <tr><th>COMPANY</th><th>POSITION</th><th>DATE APPLIED</th><th>RESUME</th></tr>
            </thead>
            <tbody id="applicationsTableBody">
              <tr><td colspan="4">Loading...</td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

 <!-- ID REQUEST MODAL -->
<div class="modal fade" id="idRequestModalBS" tabindex="-1" aria-labelledby="idRequestModalLabel">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <form id="idRequestForm" enctype="multipart/form-data">
        <div class="modal-header">
          <h5 class="modal-title">ID Request Form</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label class="form-label">Upload Valid ID *</label>
            <input type="file" name="idImage" class="form-control" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Full Name on Official Records *</label>
            <input type="text" id="fullName" name="fullName" class="form-control" maxlength="30" required readonly>
          </div>
            <div class="mb-3">
              <label class="form-label">Course Major *</label>
              <select id="degree" name="degree" class="form-control" required>
                <!-- BET Programs -->
                <option value="">Select Major</option>
                <option value="BET">BET</option>
                <option value="BET-CoET">BET-CoET</option>
                <option value="BET-ET">BET-ET</option>
                <option value="BET-ElecT">BET-ElecT</option>
                <option value="BET-MT">BET-MT</option>
                <option value="BET-MT-Auto">BET-MT-Auto</option>
                <option value="BET-MT-PP">BET-MT-PP</option>

                <!-- BTVTEd Programs -->
                <option value="BTVTEd">BTVTEd</option>
                <option value="BTVTEd-CP">BTVTEd-CP</option>
                <option value="BTVTEd-ET">BTVTEd-ET</option>

                <!-- BSIE Programs -->
                <option value="BSIE">BSIE</option>
                <option value="BSIE-HE">BSIE-HE</option>
                <option value="BSIE-IA">BSIE-IA</option>
                <option value="BSIE-ICT">BSIE-ICT</option>

                <!-- Engineering Programs -->
                <option value="BSCE">BSCE</option>
                <option value="BSEE">BSEE</option>
                <option value="BSME">BSME</option>
              </select>
            </div>
          <div class="row g-2">
            <div class="col">
              <label class="form-label">Year Graduated *</label>
              <input type="text" id="yearGraduated" name="yearGraduated" class="form-control" maxlength="4" required oninput="this.value = this.value.replace(/[^0-9]/g, '')">
            </div>
            <div class="col">
              <label class="form-label">Student No. *</label>
              <input type="text" id="studentNo" name="studentNo" class="form-control" maxlength="4" required oninput="this.value = this.value.replace(/[^0-9]/g, '')">
            </div>
          </div>
          <div class="mb-3 mt-2">
            <label class="form-label">Phone No. *</label>
            <input type="tel" id="idRequestPhoneNo" name="phoneNo" class="form-control" maxlength="12" required oninput="this.value = this.value.replace(/[^0-9]/g, '')">
          </div>
          <div class="mb-3">
            <label class="form-label">Personal Email Address *</label>
            <input type="email" id="email" name="email" class="form-control" maxlength="40" required oninput="this.value = this.value.replace(/\s/g, '')">
          </div>

          <!-- Instruction box (hidden initially) -->
          <div class="mb-3" id="idRequestInstructions" style="display:none; background:#f8f9fa; padding:10px; border-radius:5px;">
            <!-- Instructions will appear here after submission -->
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" onclick="submitIdRequestForm()">Submit</button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" onclick="document.getElementById('idRequestForm').reset()">Close</button>
        </div>
      </form>
    </div>
  </div>
</div>


  <!-- MENS BASKETBALL MODAL -->
  <div class="modal fade" id="mensBasketballModalBS" tabindex="-1">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
      <div class="modal-content">
        <form id="mensBasketballForm" class="modal-body p-4">
          <div class="modal-header">
            <h5 class="modal-title">Men's Basketball Registration "Minumum of 10 Player"</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>

          <div class="mb-3">
            <label class="form-label">Team Name</label>
            <input type="text" id="teamName" name="teamName" maxlength="20" class="form-control" required oninput="validateTeamName(this)">
            <small id="teamNameError" class="text-danger"></small>
          </div>

          <div class="mb-3">
            <label class="form-label">Age Range</label>
            <input type="text" id="ageRange" name="ageRange" maxlength="5" class="form-control" required oninput="validateAgeRange(this)">
          </div>

          <div id="membersContainer">
            <div class="member mb-2 d-flex gap-2">
              <input type="text" name="firstName[]" placeholder="First Name" maxlength="20" class="form-control" required oninput="validateName(this)">
              <input type="text" name="middleInitial[]" placeholder="M.I." maxlength="1" class="form-control" oninput="validateMiddleInitial(this)">
              <input type="text" name="lastName[]" placeholder="Last Name" maxlength="20" class="form-control" required oninput="validateName(this)">
            </div>
          </div>

          <div class="d-flex gap-2">
            <button type="button" class="btn btn-outline-secondary" onclick="addMember()">+ Add Member</button>
            <button type="submit" class="btn btn-primary">Register</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- HOMECOMING MODAL -->
  <div class="modal fade" id="homecomingModalBS" tabindex="-1">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
      <div class="modal-content">
        <form id="homecomingForm" class="modal-body p-4" enctype="multipart/form-data">
          <div class="modal-header">
            <h5 class="modal-title">Homecoming Event Registration</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>

          <div class="row g-2">
            <div class="col-md-4">
              <input type="text" name="firstName" id="firstName" placeholder="First Name" class="form-control" maxlength="20" required oninput="this.value = formatName(this.value)">
            </div>
            <div class="col-md-2">
              <input type="text" name="middleInitial" id="middleInitial" placeholder="M" class="form-control" maxlength="1" oninput="this.value = this.value.replace(/[^a-zA-Z]/g, '').toUpperCase()">
            </div>
            <div class="col-md-6">
              <input type="text" name="lastName" id="lastName" placeholder="Last Name" class="form-control" maxlength="20" required oninput="this.value = formatName(this.value)">
            </div>
          </div>

          <div class="row g-2 mt-2">
            <div class="col-md-6">
              <label class="form-label">Sex:</label>
              <select name="sex" class="form-select" required>
                <option value="" disabled selected>Select Sex</option>
                <option value="Male">Male</option><option value="Female">Female</option><option value="Other">Other</option>
              </select>
            </div>
            <div class="col-md-6">
              <label class="form-label">Program:</label>
              <select name="program" class="form-select" required>
                <option value="" disabled selected>Select Program</option>
                <option value="BET">BET</option><option value="BTVTED">BTVTED</option><option value="Other">Other</option>
              </select>
            </div>
          </div>

          <div class="row g-2 mt-2">
            <div class="col-md-6">
              <input type="text" name="yearGraduated" id="yearGraduatedHome" placeholder="Year Graduated" maxlength="4" class="form-control" required oninput="this.value = this.value.replace(/[^0-9]/g, '').slice(0,4)">
            </div>
            <div class="col-md-6">
              <label class="form-label">Add-on Options:</label>
              <div class="d-flex gap-2">
                <label class="form-check-label"><input class="form-check-input" type="radio" name="addon" value="100"> ‚Ç±100 ‚Äì 4 drinks</label>
                <label class="form-check-label"><input class="form-check-input" type="radio" name="addon" value="500"> ‚Ç±500 ‚Äì unlimited drinks</label>
                <label class="form-check-label"><input class="form-check-input" type="radio" name="addon" value="no addon"> No add-on</label>
              </div>
            </div>
          </div>

          <div class="mt-3">
            <label class="form-label">Upload Receipt (PNG/JPG only):</label>
            <input type="file" id="receiptInput" name="receipt" accept="image/png, image/jpeg" class="form-control">
          </div>

          <div class="mt-3 d-flex gap-2">
            <button type="button" id="gcashBtn" class="btn btn-outline-primary" onclick="openGcashModal()">View GCash Payment QR Code</button>
            <button type="submit" class="btn btn-primary">REGISTER</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- GCASH Modal -->
  <div class="modal fade" id="gcashModalBS" tabindex="-1">
    <div class="modal-dialog modal-md modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header"><h5 class="modal-title">GCash Payment</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
        <div class="modal-body" id="modalImageContainer">No GCash image uploaded yet.</div>
      </div>
    </div>
  </div>

  
<!-- CAREER SURVEY Modal -->
<div class="modal fade" id="careerSurveyModalBS" tabindex="-1">
  <div class="modal-dialog modal-md modal-dialog-scrollable">
    <div class="modal-content">
      <form id="careerSurveyForm" class="modal-body p-4">
        <div class="modal-header">
          <h5 class="modal-title">Career Survey</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>

        <div id="surveyQuestions">
          <!-- First Name -->
          <div class="mb-3">
            <label for="firstName" class="form-label">First Name</label>
            <input type="text" id="firstName" name="firstName" class="form-control" required>
          </div>

          <!-- Last Name -->
          <div class="mb-3">
            <label for="lastName" class="form-label">Last Name</label>
            <input type="text" id="lastName" name="lastName" class="form-control" required>
          </div>

          <!-- Field of Interest -->
          <div class="mb-3">
            <label class="form-label">Field of Interest</label>
            <div>
              <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="interested" id="interestedYes" value="Yes" required>
                <label class="form-check-label" for="interestedYes">Yes</label>
              </div>
              <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="interested" id="interestedNo" value="No">
                <label class="form-check-label" for="interestedNo">No</label>
              </div>
              <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="interested" id="interestedMaybe" value="Maybe">
                <label class="form-check-label" for="interestedMaybe">Maybe</label>
              </div>
            </div>
          </div>

          <!-- Employment Status -->
          <div class="mb-3">
            <label for="employmentStatus" class="form-label">Employment Status</label>
            <select id="employmentStatus" name="employmentStatus" class="form-select" required>
              <option value="">-- Select Status --</option>
              <option value="Employed">Employed</option>
              <option value="Unemployed">Unemployed</option>
              <option value="Student">Student</option>
            </select>
          </div>

          <!-- Inline Work -->
          <div class="mb-3">
            <label class="form-label">Inline Work</label>
            <div>
              <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="inlineWork" id="inlineWorkYes" value="Yes" required>
                <label class="form-check-label" for="inlineWorkYes">Yes</label>
              </div>
              <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="inlineWork" id="inlineWorkNo" value="No">
                <label class="form-check-label" for="inlineWorkNo">No</label>
              </div>
              <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="inlineWork" id="inlineWorkMaybe" value="Maybe">
                <label class="form-check-label" for="inlineWorkMaybe">Maybe</label>
              </div>
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <button type="submit" class="btn btn-primary">Submit Survey</button>
        </div>
      </form>
    </div>
  </div>
</div>


  <!-- EMPLOYMENT APPLICATION Modal -->
  <div class="modal fade" id="employmentFormModalBS" tabindex="-1">
    <div class="modal-dialog modal-md modal-dialog-scrollable">
      <div class="modal-content">
        <form id="employmentForm" class="modal-body p-4" enctype="multipart/form-data">
          <div class="modal-header"><h5 class="modal-title">Employment Application</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>

          <input type="hidden" name="careerId" id="employmentCareerId" value="">

          <div class="mb-2">
            <label class="form-label">First Name</label>
            <input type="text" name="firstName" class="form-control" maxlength="20" required oninput="validateNameC(this)">
          </div>
          <div class="mb-2">
            <label class="form-label">Last Name</label>
            <input type="text" name="lastName" class="form-control" maxlength="20" required oninput="validateNameC(this)">
          </div>
          <div class="mb-2">
            <label class="form-label">Phone No.</label>
            <input type="tel" id="employmentPhoneNo" name="phoneNo" class="form-control" maxlength="12" required oninput="this.value=this.value.replace(/[^0-9]/g,'')">
          </div>
          <div class="mb-2">
            <label class="form-label">Personal Email Address</label>
            <input type="email" name="email" class="form-control" required>
          </div>
          <div class="mb-2">
            <label class="form-label">RESUME (PDF)</label>
            <input type="file" name="resume" accept="application/pdf" class="form-control" required>
          </div>

          <div class="modal-footer">
            <button type="submit" class="btn btn-primary">Apply</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- SPORTFEST Modal -->
  <div class="modal fade" id="sportfestModalBS" tabindex="-1">
    <div class="modal-dialog modal-md modal-dialog-scrollable">
      <div class="modal-content">
        <form id="sportfestForm" class="modal-body p-4">
          <div class="modal-header"><h5 class="modal-title">Sport Fest Registration</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>

          <div class="mb-2">
            <input type="text" name="firstName" placeholder="First Name" maxlength="20" class="form-control" required oninput="validateName(this)">
          </div>
          <div class="mb-2">
            <input type="text" name="middleInitial" placeholder="M" maxlength="1" class="form-control" oninput="validateMiddleInitial(this)">
          </div>
          <div class="mb-2">
            <input type="text" name="lastName" placeholder="Last Name" maxlength="20" class="form-control" required oninput="validateName(this)">
          </div>
          <div class="mb-2">
            <select name="sex" class="form-select" required>
              <option value="" disabled selected>Select Gender</option><option value="Male">Male</option><option value="Female">Female</option><option value="Other">Other</option>
            </select>
          </div>
          <div class="mb-2">
            <input type="text" name="extension" placeholder="Extension (e.g., Jr)" maxlength="4" class="form-control" oninput="this.value = this.value.replace(/[^A-Za-z]/g, '').toUpperCase()">
          </div>
          <div class="mb-2">
            <input type="text" name="batch" placeholder="Batch / Year Graduated" maxlength="4" class="form-control" required oninput="this.value = this.value.replace(/[^0-9]/g, '')">
          </div>

          <input type="hidden" name="sportType" id="sportTypeField">

          <div class="modal-footer">
            <button type="submit" class="btn btn-primary">Register</button>
          </div>
        </form>
      </div>
    </div>
  </div>


  <!-- Notification / survey box (top-right) -->
  <div id="surveyNotification" class="survey-notification" style="display:none;position:fixed;right:20px;bottom:20px;z-index:2000;">
    <div id="surveyNotificationMsg" class="p-3 bg-white border rounded shadow"></div>
  </div>

  <!-- END OF HTML STRUCTURE -->

  <!-- Bootstrap JS Bundle -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- MERGED & CLEANED SCRIPT (parts 1 + 2 + 3 merged) -->
  <script type="module">


  // Import sign-out module at top level
  import { setupSignOut } from './sign-out.js';
  try {
    setupSignOut('user');
  } catch (e) {
    // module absent - ignore
    console.debug('sign-out module not loaded:', e);
  }

  // ------------------------------
  // Utility / formatting functions
  // ------------------------------
  function formatDegree(value) {
    value = (value || '').replace(/[^a-zA-Z\-]/g, '');
    const firstDash = value.indexOf('-');
    if (firstDash !== -1) value = value.substring(0, firstDash + 1) + value.substring(firstDash + 1).replace(/\-/g, '');
    return value.toUpperCase();
  }
  function formatName(value) {
    value = (value || '').replace(/[^a-zA-Z\s]/g, '');
    return value.replace(/\b\w/g, char => char.toUpperCase());
  }
  function validateAgeRange(input) {
    input.value = input.value.replace(/[^0-9-]/g, '').slice(0,5);
  }
  function validateName(input) {
    input.value = input.value.replace(/[^a-zA-Z ]/g, '').replace(/\b\w/g, c => c.toUpperCase());
  }
  function validateMiddleInitial(input) {
    input.value = input.value.replace(/[^a-zA-Z]/g, '').slice(0,1);
  }
  function validateTeamName(input) {
    const msg = document.getElementById("teamNameError");
    const regex = /^[a-zA-Z0-9 ]*$/;
    msg.textContent = regex.test(input.value) ? '' : '‚ùå Only letters, numbers, and spaces allowed.';
  }
  function validateNameC(input) {
    input.value = input.value.replace(/[^a-zA-Z\s]/g, '').toUpperCase().slice(0,20);
  }

  // ------------------------------
  // Unified Toast Helper
  // ------------------------------
// Utility to show notifications
function getNotificationContainer() {
    let container = document.getElementById('notification-container');
    if (!container) {
        container = document.createElement('div');
        container.id = 'notification-container';
        container.style.position = 'fixed';
        container.style.top = '20px';
        container.style.right = '20px';
        container.style.display = 'flex';
        container.style.flexDirection = 'column';
        container.style.gap = '10px';
        container.style.zIndex = '2000';
        document.body.appendChild(container);
    }
    return container;
}

function showNotification(message, type = 'success', duration = 4000) {
    const container = getNotificationContainer();

    const notification = document.createElement('div');
    notification.textContent = message;
    notification.style.padding = '10px 20px';
    notification.style.borderRadius = '6px';
    notification.style.color = '#fff';
    notification.style.minWidth = '200px';
    notification.style.boxShadow = '0 4px 10px rgba(0,0,0,0.15)';
    notification.style.opacity = '0';
    notification.style.transform = 'translateX(100%)';
    notification.style.transition = 'all 0.5s ease';

    // Set background color based on type
    switch (type) {
        case 'success': notification.style.backgroundColor = '#28a745'; break;
        case 'error': notification.style.backgroundColor = '#dc3545'; break;
        case 'warning': notification.style.backgroundColor = '#ffc107'; notification.style.color = '#000'; break;
        case 'info': notification.style.backgroundColor = '#0dcaf0'; break;
        default: notification.style.backgroundColor = '#333';
    }

    container.appendChild(notification);

    // Animate in
    requestAnimationFrame(() => {
        notification.style.opacity = '1';
        notification.style.transform = 'translateX(0)';
    });

    // Remove after duration
    setTimeout(() => {
        notification.style.opacity = '0';
        notification.style.transform = 'translateX(100%)';
        notification.addEventListener('transitionend', () => notification.remove());
    }, duration);
}

  // ------------------------------
  // DOM Ready consolidated
  // ------------------------------
  document.addEventListener('DOMContentLoaded', () => {
    // ‚úÖ Read role from sessionStorage
    const role = sessionStorage.getItem('userRole');

    if (!role) {
      // If no role at all ‚Üí back to login/home
      window.location.href = 'homepage.html';
    } else if (role === 'admin') {
      // ‚ùå Admins are not allowed here ‚Üí send to their page
      window.location.href = 'admin-homepage.html';
    } else if (role === 'employer') {
      // ‚ùå Employers are not allowed here ‚Üí send to their page
      window.location.href = 'employer-homepage.html';
    }


    // Wire up buttons that open modals
    document.getElementById('openProfileMenu')?.addEventListener('click', e => {
      e.preventDefault();
      const modal = new bootstrap.Modal(document.getElementById('modalProfile'));
      modal.show();
      loadProfileData(true);
    });

    document.getElementById('viewApplicationsBtn')?.addEventListener('click', () => {
      openApplicationsModal();
    });
    document.getElementById('viewApplicationsBtnSidebar')?.addEventListener('click', (e) => {
      e.preventDefault();
      openApplicationsModal();
    });

    document.getElementById('openIdRequestBtn')?.addEventListener('click', (e) => {
      e.preventDefault();
      const modal = new bootstrap.Modal(document.getElementById('idRequestModalBS'));
      modal.show();
    });
    document.getElementById('openIdRequestFromSidebar')?.addEventListener('click', (e) => {
      e.preventDefault();
      const modal = new bootstrap.Modal(document.getElementById('idRequestModalBS'));
      modal.show();
    });

    document.getElementById('changePicBtn')?.addEventListener('click', () => {
      document.getElementById('uploadProfilePic').click();
    });

    document.getElementById('galleryBtn')?.addEventListener('click', () => {
      window.location.href = 'gallery-user.html?from=user-homepage.html';
    });

    document.getElementById('signOutBtn')?.addEventListener('click', () => {
      // Make sure your sign-out module handles this; fallback:
      try { sessionStorage.removeItem('userRole'); } catch {}
      window.location.href = '/homepage.html' // adjust per your backend
    });

// profile edit/save
document.getElementById('editBtn')?.addEventListener('click', enableEdit);
document.getElementById('saveBtn')?.addEventListener('click', saveProfile);

// profile confirm
document.getElementById('confirmProfileBtn')?.addEventListener('click', async () => {
  try {
    const res = await fetch("/api/fullInformation/confirm", { 
      method: "POST", 
      credentials: "include", 
      headers: { "Content-Type": "application/json" } 
    });
    const data = await res.json();
    if (res.ok && data.success) {
      showNotification('‚úÖ Profile confirmed', 'success');
      document.getElementById('profileNotice').style.display = 'none';
      document.getElementById('confirmProfileBtn').style.display = 'none';

      const modalEl = document.getElementById("modalProfile");
      let modalObj = bootstrap.Modal.getInstance(modalEl);

      // If no instance exists, create one
      if (!modalObj) {
        modalObj = new bootstrap.Modal(modalEl);
      }

      modalObj.hide();

      // üî• Also remove any leftover backdrops (just in case)
      document.querySelectorAll(".modal-backdrop").forEach(backdrop => backdrop.remove());
    } else {
      alert(data.error || 'Please upload a profile picture first.');
    }
  } catch (err) {
    console.error(err);
    alert('Server error while confirming profile.');
  }
});

// Attach file upload handler
document.getElementById('uploadProfilePic')?.addEventListener('change', async (event) => {
  const file = event.target.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = e => {
    const url = e.target.result;
    document.getElementById('modalProfilePic').src = url;
    document.getElementById('profilePic').src = url;
    document.getElementById('profilePicSmall').src = url;
  };
  reader.readAsDataURL(file);

  const formData = new FormData();
  formData.append('profilePic', file);

  try {
    const res = await fetch('/api/fullInformation/upload-picture', { 
      method: 'POST', 
      body: formData, 
      credentials: 'include' 
    });
    const data = await res.json();

    if (data.success && data.imageUrl) {
      // ‚úÖ Update UI
      document.getElementById('modalProfilePic').src = data.imageUrl;
      document.getElementById('profilePic').src = data.imageUrl;
      document.getElementById('profilePicSmall').src = data.imageUrl;

      // ‚úÖ Save new profile pic in localStorage
      let user = JSON.parse(localStorage.getItem("user") || "{}");
      user.profilePic = data.imageUrl;
      localStorage.setItem("user", JSON.stringify(user));

      // ‚úÖ Unlock modal closing
      const profileModalEl = document.getElementById("modalProfile");
      profileModalEl.removeAttribute("data-bs-backdrop");
      profileModalEl.removeAttribute("data-bs-keyboard");
      profileModalEl.querySelector(".btn-close")?.classList.remove("d-none");

      const modalInstance = bootstrap.Modal.getInstance(profileModalEl);
      if (modalInstance) {
        modalInstance._config.backdrop = true;
        modalInstance._config.keyboard = true;
      }

      // Hide warning
      document.getElementById("profileNotice").style.display = "none";

      showNotification('‚úÖ Profile picture updated! You can now close this modal.', 'success');
    } else {
      showNotification('‚ùå Upload failed', 'error');
    }
  } catch (err) {
    console.error(err);
    showNotification('‚ùå Server error while uploading', 'error');
  }
});

// üîí Safeguard: Prevent closing if still default pic
document.getElementById("modalProfile").addEventListener("hide.bs.modal", (event) => {
  const pic = document.getElementById("modalProfilePic").src;
  if (pic.includes("default-profile.png")) {
    event.preventDefault();
    const notice = document.getElementById("profileNotice");
    notice.style.display = "block";
    notice.textContent = "‚ö†Ô∏è Please upload a profile picture before closing.";
  }
});


    // Applications open handler
    document.getElementById('openApplicationsFromSidebar')?.addEventListener('click', e => { e.preventDefault(); openApplicationsModal(); });

    // Mens basketball open
    document.getElementById('teamName')?.addEventListener('input', (e) => validateTeamName(e.target));
  });

  // ------------------------------
  // LOAD ANNOUNCEMENTS / EVENTS / CAREERS
  // ------------------------------
  async function loadIdAnnouncements() {
    const container = document.getElementById('idAnnouncementList');
    container.innerHTML = 'Loading...';
    try {
      const res = await fetch('/api/admin/id-announcements');
      if (!res.ok) throw new Error('Failed to load ID announcements');
      const { announcements } = await res.json();
      container.innerHTML = (announcements && announcements.length) ? announcements.map(a => {
        return `<div class="mb-2"><div class="small badge-custom">ID ANNOUNCEMENT</div><div class="fw-semibold">${escapeHtml(a.title || '')}</div><div class="small text-muted">${new Date(a.datePosted).toLocaleDateString()}</div></div>`;
      }).join('') : '<div>No announcements found.</div>';
    } catch (err) {
      console.error(err);
      container.innerHTML = '<div class="text-danger">Failed to load announcements</div>';
    }
  }

  async function loadEvents() {
    const container = document.getElementById('eventList');
    container.innerHTML = 'Loading...';
    try {
      const res = await fetch('/api/events');
      if (!res.ok) throw new Error('Failed to load events');
      const { events } = await res.json();
      container.innerHTML = (events && events.length) ? events.map(e => {
        return `<div class="mb-2"><div class="small badge-custom">EVENT</div><div class="fw-semibold">${escapeHtml(e.title || '')}</div><div class="small text-muted">${new Date(e.datePosted).toLocaleDateString()}</div></div>`;
      }).join('') : '<div>No announcements found.</div>';
    } catch (err) {
      console.error(err);
      container.innerHTML = '<div class="text-danger">Failed to load events</div>';
    }
  }

  async function loadCareers() {
    const container = document.getElementById('careerList');
    container.innerHTML = 'Loading...';
    try {
      const role = sessionStorage.getItem("userRole");
      let careersUrl = (role === "admin") ? "/api/careers/all" : (role === "employer") ? "/api/careers" : "/api/careers/public";
      const res = await fetch(careersUrl);
      if (!res.ok) throw new Error('Failed to load careers');
      const { careers } = await res.json();
      container.innerHTML = (careers && careers.length) ? careers.slice(0, 10).map(c => {
        return `<div class="mb-2"><div class="small badge-custom">CAREER</div><div class="fw-semibold">${escapeHtml(c.title || '')}</div><div class="small text-muted">${new Date(c.datePosted).toLocaleDateString()}</div></div>`;
      }).join('') : '<div>No announcements found.</div>';
    } catch (err) {
      console.error(err);
      container.innerHTML = '<div class="text-danger">Failed to load careers</div>';
    }
  }

  // ------------------------------
  // FEED: combined events + careers with countdown
  // ------------------------------
  function parseDate(input) {
    if (!input) return null;
    const d = new Date(input);
    return isNaN(d.getTime()) ? null : d;
  }

async function loadFeed() {
  const container = document.getElementById('feed');
  container.innerHTML = 'Loading feed...';
  try {
    const role = sessionStorage.getItem('userRole');
    const careersUrl = role === 'employer' ? '/api/careers' : '/api/careers/public';

    const [eventsRes, careersRes] = await Promise.all([ fetch('/api/events'), fetch(careersUrl) ]);
    if (!eventsRes.ok || !careersRes.ok) throw new Error('Failed to fetch');

    const { events } = await eventsRes.json();
    const { careers } = await careersRes.json();

    // ‚úÖ Sort so active stay on top, closed go down
    const feed = [
      ...(events || []).map(e => ({ ...e, type: 'Event' })),
      ...(careers || []).map(c => ({ ...c, type: 'Career' }))
    ].sort((a, b) => {
      function getDeadline(post) {
        if (post.type === 'Career') {
          const posted = parseDate(post.datePosted) || new Date();
          return new Date(posted.getTime() + 5 * 24 * 60 * 60 * 1000);
        } else if (post.type === 'Event') {
          return parseDate(post.eventDateTime) || parseDate(post.datePosted);
        }
        return null;
      }

      const now = Date.now();
      const aDeadline = getDeadline(a);
      const bDeadline = getDeadline(b);

      const aClosed = aDeadline && aDeadline.getTime() < now;
      const bClosed = bDeadline && bDeadline.getTime() < now;

      if (aClosed !== bClosed) return aClosed ? 1 : -1; // Active before closed
      return new Date(b.datePosted) - new Date(a.datePosted); // Newest first
    });

    // ‚úÖ Render feed
    container.innerHTML = feed.map((post, idx) => {
      const imgSrc = post.image || "";
      const extraInfo = post.type === 'Event'
        ? `üéâ Event Location: ${escapeHtml(post.location || 'N/A')}`
        : `üè¢ Company: ${escapeHtml(post.link || 'N/A')}`;

      let deadlineDate = null;
      if (post.type === 'Career') {
        const posted = parseDate(post.datePosted) || new Date();
        deadlineDate = new Date(posted.getTime() + 5 * 24 * 60 * 60 * 1000);
      } else if (post.type === 'Event') {
        deadlineDate = parseDate(post.eventDateTime) || parseDate(post.datePosted);
      }
      const deadlineMs = deadlineDate ? deadlineDate.getTime() : '';

      return `
        <div class="feed-card" id="feed-card-${post.id}">
          <!-- Header with logo -->
          <div class="feed-header d-flex justify-content-between align-items-start mb-2">
            <div class="d-flex align-items-center">
              <img src="Logo2.png" alt="Logo2" class="rounded-circle me-2" style="width:40px; height:40px; object-fit:cover;">
              <div>
                <div class="fw-bold">TUP Cavite Alumni Association</div>
                <small class="text-muted">Posted: ${new Date(post.datePosted).toLocaleString()}</small>
              </div>
            </div>
            <div>
              ${post.type === 'Career' 
                ? `<span class="badge bg-success">Career</span>` 
                : `<span class="badge bg-info">Event</span>`}
            </div>
          </div>

          <!-- Image -->
          ${imgSrc ? `<img class="feed-img" src="${imgSrc}" alt="" onerror="this.style.display='none'">` : ''}

          <!-- Content -->
          <div class="fw-bold mt-2">${escapeHtml((post.title||'').toUpperCase())}</div>
          <p class="mb-1">${escapeHtml(post.description || '')}</p>
          <div class="text-muted small">
            ${extraInfo}
          </div>

          <!-- Footer -->
          <div class="d-flex justify-content-between align-items-center mt-2">
            <span class="countdown text-muted" data-time="${deadlineMs}" id="countdown-${idx}"></span>
            ${post.type === 'Career'
              ? `<button class="btn btn-sm btn-primary register-btn" data-id="${post.id}" data-type="Career">Apply</button>`
              : `<button class="btn btn-sm btn-outline-primary register-btn" data-id="${post.id}" data-type="Event">Register</button>`}
          </div>
        </div>`;
    }).join('');

    // ‚úÖ Handle register clicks
    container.addEventListener('click', (e) => {
      const btn = e.target.closest('.register-btn');
      if (!btn) return;
      const id = btn.dataset.id;
      const type = btn.dataset.type;
      const post = feed.find(p => p.id == id && p.type === type);
      if (type === 'Career') openCareerSurvey(post);
      else openRegistrationModal(post);
    });

    // ‚úÖ Countdown updater
    function updateCountdowns() {
      const now = Date.now();
      document.querySelectorAll('.countdown').forEach(el => {
        const ms = Number(el.dataset.time);
        if (!ms || isNaN(ms)) return el.textContent = '‚Äî';
        const diff = ms - now;
        const card = el.closest('.feed-card');
        const btn = card?.querySelector('.register-btn');
        if (diff <= 0) {
          el.textContent = '‚ùå Closed';
          card.style.filter = 'grayscale(100%)';
          if (btn) { btn.disabled = true; btn.textContent = '‚ùå Closed'; }
          return;
        }
        const d = Math.floor(diff / (1000*60*60*24));
        const h = Math.floor((diff % (1000*60*60*24)) / (1000*60*60));
        const m = Math.floor((diff % (1000*60*60)) / (1000*60));
        const s = Math.floor((diff % (1000*60)) / 1000);
        el.textContent = d > 0 ? `${d}d ${h}h ${m}m ${s}s left` : `${h}h ${m}m ${s}s left`;
      });
    }
    updateCountdowns();
    setInterval(updateCountdowns, 1000);

  } catch (err) {
    console.error('Failed to load feed:', err);
    container.innerHTML = '<div class="text-danger">‚ö†Ô∏è Failed to load feed.</div>';
  }
}

  // ------------------------------
  // REGISTRATION MODAL OPENERS
  // ------------------------------
function openRegistrationModal(post) {
  if (!post || !post.title) return console.warn('Invalid post passed:', post);

  const title = (post.title || '').toUpperCase();
  const knownTitles = [
    "MENSBASKETBALL",
    "MEN'S BASKETBALL",
    "HOMECOMING EVENT",
    "SPORT FEST EVENT",
    "SPORTS FEST",
    "SPORT FEST",
    "CAREER FAIR"
  ];

  // Known title cases
  if (title === "MENSBASKETBALL" || title === "MEN'S BASKETBALL") {
    new bootstrap.Modal(document.getElementById('mensBasketballModalBS')).show();
  } else if (title === "HOMECOMING EVENT") {
    new bootstrap.Modal(document.getElementById('homecomingModalBS')).show();
  } else if (
    title === "SPORT FEST EVENT" ||
    title === "SPORTS FEST" ||
    title === "SPORT FEST"
  ) {
    document.getElementById('sportTypeField').value = post.location || '';
    new bootstrap.Modal(document.getElementById('sportfestModalBS')).show();
  } else if (title === "CAREER FAIR") {
    openCareerModal(post);
  } else {
    // fallback: any unknown title (admin chose Other) -> treat as Sport Fest
    console.log('Unknown or "Other" event, opening Sport Fest modal for:', title);
    document.getElementById('sportTypeField').value = post.location || '';
    new bootstrap.Modal(document.getElementById('sportfestModalBS')).show();
  }
}



// ------------------------------
// Mens Basketball Registration
// ------------------------------
const mbForm = document.getElementById('mensBasketballForm');
const membersContainer = document.getElementById('membersContainer');

// Toast helper for warnings
function showRegistrationWarning(message) {
  showNotification(`‚ö†Ô∏è ${message}`, 'warning');
}

// Add member function (exposed globally)
window.addMember = function() {
  const container = document.getElementById('membersContainer');
  if (!container) return;

  const currentCount = container.querySelectorAll("input[name='firstName[]']").length;

  // Enforce max 20
  if (currentCount >= 20) {
    // ensure toast container exists
    if (!document.getElementById("toast-container")) {
      const toastContainer = document.createElement("div");
      toastContainer.id = "toast-container";
      toastContainer.style.position = "fixed";
      toastContainer.style.top = "80px";
      toastContainer.style.right = "20px";
      toastContainer.style.zIndex = "2000";
      toastContainer.style.display = "flex";
      toastContainer.style.flexDirection = "column";
      toastContainer.style.gap = "8px";
      document.body.appendChild(toastContainer);
    }
    showNotification(`‚ö†Ô∏è Maximum 20 members allowed. Currently added: ${currentCount}`, 'warning');
    return;
  }

  const div = document.createElement('div');
  div.className = 'member mb-2 d-flex gap-2';
  div.innerHTML = `
    <input type="text" name="firstName[]" placeholder="First Name" maxlength="20" class="form-control" required oninput="validateName(this)">
    <input type="text" name="middleInitial[]" placeholder="M.I." maxlength="1" class="form-control" oninput="validateMiddleInitial(this)">
    <input type="text" name="lastName[]" placeholder="Last Name" maxlength="20" class="form-control" required oninput="validateName(this)">
  `;
  container.appendChild(div);

  const newCount = container.querySelectorAll("input[name='firstName[]']").length;
  showNotification(`Members added: ${newCount}`, 'info');
};


// Handle form submission
mbForm?.addEventListener('submit', async (e) => {
  e.preventDefault();

  const teamName = document.getElementById('teamName').value.trim();
  const ageRange = document.getElementById('ageRange').value.trim();

  const firstNames = membersContainer.querySelectorAll("input[name='firstName[]']");
  const middleInitials = membersContainer.querySelectorAll("input[name='middleInitial[]']");
  const lastNames = membersContainer.querySelectorAll("input[name='lastName[]']");
  const players = [];

  firstNames.forEach((input, i) => {
    if (input.value.trim() || (lastNames[i] && lastNames[i].value.trim())) {
      players.push({ 
        firstName: input.value.trim(), 
        middleInitial: middleInitials[i].value.trim(), 
        lastName: lastNames[i].value.trim() 
      });
    }
  });



  // Minimum and maximum player checks
  if (players.length < 10) { 
    showRegistrationWarning(`You need at least 10 members. Currently added: ${players.length}`); 
    return; 
  }
  if (players.length > 20) { 
    showRegistrationWarning(`Maximum 20 members allowed. Currently added: ${players.length}`); 
    return; 
  }

  const payload = { teamName, ageRange, players };

  try {
    const res = await fetch('/api/sportfest/mensBasketball', { 
      method: 'POST', 
      headers: { 'Content-Type': 'application/json' }, 
      body: JSON.stringify(payload) 
    });
    const data = await res.json();
    if (!res.ok) throw new Error(data.error || 'Failed to register');

    showNotification(`‚úÖ Team registered successfully! Players: ${data.playerCount || players.length}`, 'success');

    // Close modal, reset form, clear members
    bootstrap.Modal.getInstance(document.getElementById('mensBasketballModalBS'))?.hide();
    mbForm.reset();
    membersContainer.innerHTML = `
      <div class="member mb-2 d-flex gap-2">
        <input type="text" name="firstName[]" placeholder="First Name" maxlength="20" class="form-control" required oninput="validateName(this)">
        <input type="text" name="middleInitial[]" placeholder="M.I." maxlength="1" class="form-control" oninput="validateMiddleInitial(this)">
        <input type="text" name="lastName[]" placeholder="Last Name" maxlength="20" class="form-control" required oninput="validateName(this)">
      </div>
    `;
  } catch (err) {
    console.error(err);
    showNotification('‚ùå Error: ' + (err.message || err), 'error');
  }
});


document.addEventListener("DOMContentLoaded", () => {

  // -----------------------------
  // Countdown helper
  // -----------------------------
  function startSeparateCountdown(boxId, spanId, endTimeKey, cooldownMs) {
    const box = document.getElementById(boxId);
    const span = document.getElementById(spanId);
    if (!box || !span) return;

    let endTime = localStorage.getItem(endTimeKey);
    if (endTime) endTime = new Date(endTime);
    else {
      endTime = new Date(Date.now() + cooldownMs);
      localStorage.setItem(endTimeKey, endTime.toISOString());
    }

    if (window[endTimeKey + "_timer"]) clearInterval(window[endTimeKey + "_timer"]);

    function update() {
      const now = new Date();
      const diff = endTime - now;

      if (diff <= 0) {
        box.style.display = 'none';
        clearInterval(window[endTimeKey + "_timer"]);
        localStorage.removeItem(endTimeKey);
        return;
      }

      span.textContent = `${Math.ceil(diff / 1000)}s`;
      box.style.display = 'block';
    }

    update();
    window[endTimeKey + "_timer"] = setInterval(update, 1000);
  }

  // -----------------------------
  // Open Career Survey
  // -----------------------------
window.openCareerSurvey = async function(career) {
  window.currentCareer = career;
  const careerId = career?.id;
  const userId = sessionStorage.getItem('userId');
  if (!careerId || !userId) return;

  try {
    // Check if user has ever submitted survey
    const resFull = await fetch(`/api/responses/checkFullSurvey?userId=${userId}`);
    const fullData = await resFull.json();

    const now = new Date();
    const lastFullStr = localStorage.getItem('fullSurveyCooldown');
    const lastFullTime = lastFullStr ? new Date(lastFullStr) : null;

    const fullCooldownMs = 30 * 24 * 60 * 60 * 1000; // 30 days

    // Case 1: Never submitted OR cooldown expired ‚Üí show full survey
    if (!fullData.submittedAny || (lastFullTime && now >= lastFullTime)) {
      new bootstrap.Modal(
        document.getElementById('careerSurveyModalBS'),
        { backdrop: 'static', keyboard: false }
      ).show();
      return;
    }

    // Case 2: Cooldown active ‚Üí show employment form directly
    const diffMs = now - lastFullTime;
    if (diffMs < fullCooldownMs) {
      new bootstrap.Modal(
        document.getElementById('employmentFormModalBS'),
        { backdrop: 'static', keyboard: false }
      ).show();
      return;
    }

    // Case 3: Safety net ‚Üí full survey again
    new bootstrap.Modal(
      document.getElementById('careerSurveyModalBS'),
      { backdrop: 'static', keyboard: false }
    ).show();

  } catch (err) {
    console.error("‚ùå Failed to load survey status:", err);
  }
};


  // -----------------------------
  // Full Career Survey Submit
  // -----------------------------
  const careerForm = document.getElementById('careerSurveyForm');
  careerForm?.addEventListener('submit', async function(ev) {
    ev.preventDefault();
    const form = ev.target;

    const payload = {
      userId: sessionStorage.getItem('userId'),
      careerId: window.currentCareer?.id || '',
      firstName: form.firstName.value,
      lastName: form.lastName.value,
      interested: form.interested.value,
      employmentStatus: form.employmentStatus.value,
      inlineWork: form.inlineWork.value
    };

    try {
      const res = await fetch('/api/responses/add', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });
      const data = await res.json();
      if (!res.ok) throw new Error(data.error || 'Failed to submit survey');

      // Hide modal & show success
      bootstrap.Modal.getInstance(document.getElementById('careerSurveyModalBS'))?.hide();
      showNotification('‚úÖ Career survey submitted!', 'success');

      // Set full survey cooldown = 30 seconds
      const fullCooldownMs =  30 * 24 * 60 * 60 * 1000;
      const cooldownEnd = new Date(Date.now() + fullCooldownMs);
      localStorage.setItem('fullSurveyCooldown', cooldownEnd.toISOString());

      startSeparateCountdown(
        'fullSurveyCountdownBox',
        'fullSurveyCountdown',
        'fullSurveyCooldown',
        fullCooldownMs
      );

      // Always show employment form after survey
      new bootstrap.Modal(document.getElementById('employmentFormModalBS'), {
        backdrop: 'static',
        keyboard: false
      }).show();

    } catch (err) {
      console.error(err);
      showNotification('‚ùå Failed to submit survey', 'error');
    }
  });

  // -----------------------------
  // Employment Form Submit
  // -----------------------------
  const employmentForm = document.getElementById('employmentForm');
  employmentForm?.addEventListener('submit', async function(ev) {
    ev.preventDefault();
    const form = ev.target;
    const fd = new FormData(form);
    fd.set('careerId', window.currentCareer?.id || '');

    try {
      const res = await fetch('/api/applications/add', { method: 'POST', body: fd });
      const data = await res.json();
      if (!res.ok) throw new Error(data.error || 'Failed to submit application');

      bootstrap.Modal.getInstance(document.getElementById('employmentFormModalBS'))?.hide();
      showNotification('‚úÖ Employment application submitted!', 'success');
    } catch (err) {
      console.error(err);
      showNotification('‚ùå Failed to submit application', 'error');
    }
  });
});



  // ------------------------------
  // HOMECOMING form submit
  // ------------------------------
  let gcashEnabled = localStorage.getItem('gcashEnabled') === 'true';
  function openGcashModal() {
    if (!gcashEnabled) { showNotification('‚ùå GCash payment option is currently disabled by admin.', 'error'); return; }
    const img = localStorage.getItem('gcashImage');
    const container = document.getElementById('modalImageContainer');
    container.innerHTML = img ? `<img src="${img}" alt="GCash" style="max-width:100%;"/>` : 'No GCash image uploaded yet.';
    new bootstrap.Modal(document.getElementById('gcashModalBS')).show();
  }

  document.getElementById('homecomingForm')?.addEventListener('submit', async function(ev) {
    ev.preventDefault();
    const fd = new FormData(ev.target);
    const addon = fd.get('addon');
    if ((addon === '100' || addon === '500') && !gcashEnabled) { showNotification('‚ùå Registration blocked: GCash payment disabled.', 'error'); return; }
    if ((addon === '100' || addon === '500') && !fd.get('receipt')?.name) { showNotification('‚ùå Receipt is required for selected add-on', 'error'); return; }
    try {
      const res = await fetch('/api/homeregs', { method: 'POST', body: fd });
      const data = await res.json();
      if (!res.ok) throw new Error(data.error || 'Server error');
      showNotification('üéâ Registration successful!', 'success');
      bootstrap.Modal.getInstance(document.getElementById('homecomingModalBS')).hide();
      ev.target.reset();
    } catch (err) {
      console.error(err);
      showNotification('‚ùå ' + (err.message || err), 'error');
    }
  });

  // ------------------------------
  // SPORTFEST form
  // ------------------------------
  document.getElementById('sportfestForm')?.addEventListener('submit', async function(ev) {
    ev.preventDefault();
    const data = new FormData(ev.target);
    const payload = {
      firstName: data.get('firstName')?.trim(),
      middleName: data.get('middleInitial')?.trim() || '',
      lastName: data.get('lastName')?.trim(),
      gender: data.get('sex')?.trim(),
      extension: data.get('extension')?.trim() || '',
      yearGraduated: data.get('batch')?.trim() || '',
      sportType: data.get('sportType')?.trim() || ''
    };
    if (!payload.firstName || !payload.lastName || !payload.gender || !payload.sportType) {
      return showNotification('‚ùå Please complete all required fields.', 'error');
    }
    try {
      const res = await fetch('/api/allsport/add', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
      const json = await res.json();
      if (!res.ok) throw new Error(json.error || 'Server error');
      showNotification('üéâ Sportfest registration successful!', 'success');
      bootstrap.Modal.getInstance(document.getElementById('sportfestModalBS')).hide();
      ev.target.reset();
    } catch (err) {
      console.error(err);
      showNotification('‚ùå Error: ' + (err.message || err), 'error');
    }
  });

  // ------------------------------
  // ID REQUEST submit
  // ------------------------------

  // Auto-fill Full Name when the modal opens
  const idRequestModal = document.getElementById('idRequestModalBS');
  idRequestModal.addEventListener('show.bs.modal', function () {
    const firstName = sessionStorage.getItem('firstName') || '';
    const lastName = sessionStorage.getItem('lastName') || '';
    const fullName = [firstName, lastName].filter(Boolean).join(' ') || '';
    document.getElementById('fullName').value = fullName;
  });

async function submitIdRequestForm() {
  const form = document.getElementById('idRequestForm');
  const instructionsDiv = document.getElementById('idRequestInstructions');
  const modal = bootstrap.Modal.getInstance(document.getElementById('idRequestModalBS'));

  const fd = new FormData(form);

  try {
    const res = await fetch('/api/requests/add', { method: 'POST', body: fd });
    const data = await res.json();
    if (!res.ok) throw new Error(data.error || 'Unknown error');

    showNotification('‚úÖ Submission Successful!', 'success');

    // Disable form inputs
    form.querySelectorAll('input, button').forEach(el => el.disabled = true);

    // Show instructions
    instructionsDiv.style.display = 'block';
    instructionsDiv.innerHTML = `
      <h5>Request Submitted Successfully!</h5>
      <p>Please wait for your ID request to be processed. You can check your request status anytime in the "ID Request Status" section.</p>
      <p>Do not submit multiple requests for the same ID.</p>
    `;

    // Keep the modal open so user can read instructions

  } catch (err) {
    console.error(err);
    showNotification('‚ùå Submission failed: ' + (err.message || err), 'error');
  }
}



  // ------------------------------
  // PROFILE data loading, edit & save
  // ------------------------------
  async function loadProfileData(updateModal = false) {
    try {
      const res = await fetch('/api/fullInformation/me', { credentials: 'include', cache: 'no-store' });
      if (!res.ok) throw new Error('Not logged in');
      const data = await res.json();
      const pic = data.profilePic || '/public/images/default-profile.png';
      document.getElementById('profilePic').src = pic;
      document.getElementById('profilePicSmall').src = pic;
      document.getElementById('modalProfilePic').src = pic;
      document.getElementById('name').textContent = ([data.firstName, data.lastName].filter(Boolean).join(' ') || 'No Name').toUpperCase();
      document.getElementById('nameTop').textContent = ([data.firstName, data.lastName].filter(Boolean).join(' ') || 'No Name');
      document.getElementById('userName').textContent = data.userName || '-';
      document.getElementById('personalEmail').textContent = data.personalEmail || '-';
      document.getElementById('phoneNo').textContent = data.phoneNo || '-';
      document.getElementById('gender').textContent = data.gender || '-';
      document.getElementById('dateBirth').textContent = data.dateBirth ? new Date(data.dateBirth).toLocaleDateString() : '-';
      document.getElementById('major').textContent = data.major || '-';
      document.getElementById('yearStarted').textContent = data.yearStarted || '-';
      document.getElementById('graduated').textContent = data.graduated || '-';
      document.getElementById('studentNo').textContent = data.studentNo || '-';
      document.getElementById('displayName').textContent = `${(data.firstName||'').toUpperCase()} ${(data.lastName||'').toUpperCase()}`;
      // handle profile confirmation enforcement
      enforceProfilePictureFlow(data);
    } catch (err) {
      console.error('Error loading profile:', err);
    }
  }

  function enableEdit() {
    document.getElementById('personalEmail').style.display = 'none';
    document.getElementById('editPersonalEmail').style.display = 'inline-block';
    document.getElementById('editPersonalEmail').value = document.getElementById('personalEmail').textContent;
    document.getElementById('phoneNo').style.display = 'none';
    document.getElementById('editPhoneNo').style.display = 'inline-block';
    document.getElementById('editPhoneNo').value = document.getElementById('phoneNo').textContent;
    document.getElementById('editBtn').style.display = 'none';
    document.getElementById('saveBtn').style.display = 'inline-block';
  }

  async function saveProfile() {
    const updatedData = { personalEmail: document.getElementById('editPersonalEmail').value, phoneNo: document.getElementById('editPhoneNo').value };
    try {
      const res = await fetch('/api/fullInformation/update', { method: 'POST', headers: { 'Content-Type': 'application/json' }, credentials: 'include', body: JSON.stringify(updatedData) });
      const data = await res.json();
      if (data.success) {
        showNotification('‚úÖ Profile updated!', 'success');
        document.getElementById('personalEmail').textContent = updatedData.personalEmail;
        document.getElementById('phoneNo').textContent = updatedData.phoneNo;
        document.getElementById('personalEmail').style.display = 'inline';
        document.getElementById('phoneNo').style.display = 'inline';
        document.getElementById('editPersonalEmail').style.display = 'none';
        document.getElementById('editPhoneNo').style.display = 'none';
        document.getElementById('editBtn').style.display = 'inline-block';
        document.getElementById('saveBtn').style.display = 'none';
      } else {
        showNotification('‚ùå Error: ' + (data.error || 'unknown'), 'error');
      }
    } catch (err) {
      console.error(err);
      showNotification('Server error while updating', 'error');
    }
  }

  // ------------------------------
  // enforce profile picture flow
  // ------------------------------
  function enforceProfilePictureFlow(user) {
    // if user passed, use it; otherwise fetch
    const modalEl = document.getElementById('modalProfile');
    const notice = document.getElementById('profileNotice');
    const confirmBtn = document.getElementById('confirmProfileBtn');

    if (!user) {
      // nothing to enforce if no user
      return;
    }

    const pic = user.profilePic || '';
    const isDefault = !pic || pic.includes('default-profile.png') || pic.includes('/public/images/default-profile.png');
    if (user.profileConfirmed === 1) {
      notice.style.display = 'none';
      confirmBtn.style.display = 'none';
      return;
    }
    // show modal with lock if not confirmed
    const modalObj = new bootstrap.Modal(modalEl);
    modalObj.show();
    if (isDefault) {
      notice.style.display = 'block';
      notice.textContent = '‚ö†Ô∏è Please upload your profile picture to continue.';
      confirmBtn.style.display = 'inline-block';
      confirmBtn.disabled = true;
    } else {
      notice.style.display = 'block';
      notice.textContent = '‚úÖ Picture uploaded. Click Confirm to continue.';
      confirmBtn.style.display = 'inline-block';
      confirmBtn.disabled = false;
    }
  }

  // hook upload show confirm (polls after upload)
  function hookUploadShowConfirm() {
    const input = document.getElementById('uploadProfilePic');
    if (!input) return;
    input.addEventListener('change', () => {
      const tryCheck = async (attempt = 0) => {
        if (attempt > 8) return;
        try {
          const res = await fetch('/api/fullInformation/me', { credentials: 'include', cache: 'no-store' });
          if (res.ok) {
            const u = await res.json();
            const pic = u.profilePic || '';
            const isDefault = !pic || pic.includes('default-profile.png') || pic.includes('/public/images/default-profile.png');
            if (!isDefault && u.profileConfirmed !== 1) {
              const confirmBtn = document.getElementById('confirmProfileBtn');
              if (confirmBtn) { confirmBtn.style.display = 'inline-block'; confirmBtn.disabled = false; }
              const notice = document.getElementById('profileNotice'); if (notice) notice.textContent = '‚úÖ Picture uploaded. Click Confirm to continue.';
              return;
            }
          }
        } catch (e) {}
        setTimeout(() => tryCheck(attempt + 1), 500);
      };
      setTimeout(() => tryCheck(0), 400);
    });
  }

  // ------------------------------
  // APPLICATIONS modal loader
  // ------------------------------
  async function openApplicationsModal() {
    const modalEl = document.getElementById('applicationsModalBS');
    const tableBody = document.getElementById('applicationsTableBody');
    tableBody.innerHTML = '<tr><td colspan="4">Loading...</td></tr>';
    new bootstrap.Modal(modalEl).show();
    try {
      const res = await fetch(`/api/applications/user/${encodeURIComponent(document.getElementById('userName')?.textContent || '')}`, { credentials: 'include' });
      if (!res.ok) throw new Error('Failed to fetch applications');
      const apps = await res.json();
      if (!apps.length) {
        tableBody.innerHTML = '<tr><td colspan="4">No applications found.</td></tr>';
        return;
      }
      tableBody.innerHTML = apps.map(app => `<tr><td>${escapeHtml(app.company)}</td><td>${escapeHtml(app.careerTitle)}</td><td>${new Date(app.dateSubmitted).toLocaleDateString()}</td><td><a href="/uploads/resumes/${escapeHtml(app.resumePath)}" target="_blank">View</a></td></tr>`).join('');
    } catch (err) {
      console.error(err);
      tableBody.innerHTML = '<tr><td colspan="4">‚ö†Ô∏è Error loading applications.</td></tr>';
    }
  }

  // ------------------------------
  // Survey notification helper
  // ------------------------------
  function showSurveyNotification(message, type = 'success') {
    const box = document.getElementById('surveyNotification');
    const msg = document.getElementById('surveyNotificationMsg');
    msg.innerHTML = message;
    box.style.display = 'block';
    setTimeout(() => { box.style.display = 'none'; }, 4000);
  }

  // ------------------------------
  // Filter feed
  // ------------------------------
  function filterFeed() {
    const query = document.getElementById('feedSearch').value.toLowerCase();
    document.querySelectorAll('.feed-card').forEach(card => {
      const text = card.innerText.toLowerCase();
      card.style.display = text.includes(query) ? 'block' : 'none';
    });
  }
  window.filterFeed = filterFeed;

  // ------------------------------
  // Misc helpers
  // ------------------------------
  function escapeHtml(s) { if (!s) return ''; return String(s).replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }

  // ------------------------------
  // Initial load
  // ------------------------------
  (async function init() {
    await Promise.all([ loadIdAnnouncements(), loadEvents(), loadCareers(), loadFeed() ]);
    // try to set displayName (calls /api/auth/me)
    fetch('/api/auth/me').then(res => { if (!res.ok) throw new Error('Not logged in'); return res.json(); }).then(user => {
      document.getElementById('displayName').textContent = `${(user.firstName||'').toUpperCase()} ${(user.lastName||'').toUpperCase()}`;
    }).catch(() => {
      document.getElementById('displayName').textContent = 'GUEST';
    });
    // load profile async (non-blocking)
    loadProfileData(true);
  })();

  // expose some functions for inline handlers
  window.openMensBasketballModal = () => new bootstrap.Modal(document.getElementById('mensBasketballModalBS')).show();
  window.openSportfestModal = (post) => {
    document.getElementById('sportTypeField').value = post?.location || '';
    new bootstrap.Modal(document.getElementById('sportfestModalBS')).show();
  };
  window.openHomecomingModal = () => new bootstrap.Modal(document.getElementById('homecomingModalBS')).show();
  window.openGcashModal = openGcashModal;

  // Expose some utilities
  window.formatDegree = formatDegree;
  window.formatName = formatName;
  window.validateTeamName = validateTeamName;
  window.validateName = validateName;
  window.validateAgeRange = validateAgeRange;
  window.validateMiddleInitial = validateMiddleInitial;
  window.validateNameC = validateNameC;
  window.submitIdRequestForm = submitIdRequestForm;
  window.openCareerPopup = () => new bootstrap.Modal(document.getElementById('careerSurveyModalBS')).show();

  // End of module


// ================================
// üìå ID Request Status (User Side)
// ================================
// Open ID Request Status modal
document.getElementById('openIdStatusSidebar')?.addEventListener('click', async (e) => {
  e.preventDefault();
  await fetchUserIdRequestStatus();
});



async function fetchUserIdRequestStatus() {
  const content = document.getElementById('idRequestStatusContent');
  content.innerHTML = 'Loading status...';

  const userName = sessionStorage.getItem('userName');
  if (!userName) {
    content.innerHTML = '‚ö†Ô∏è No user session found. Please log in first.';
    new bootstrap.Modal(document.getElementById('idStatusModalBS')).show();
    return;
  }

  try {
    const res = await fetch(`/api/requests/user/byusername/${encodeURIComponent(userName)}`);
    if (!res.ok) throw new Error('Failed to fetch request status');

    const request = await res.json();
    if (!request) {
      content.innerHTML = '‚ùå You haven‚Äôt submitted an ID request yet.';
    } else {
      const status = request.status || 'PENDING';
      content.innerHTML = `
        <p><strong>Status:</strong> <span class="badge bg-${getStatusColor(status)}">${status}</span></p>
        <p><strong>Submitted On:</strong> ${new Date(request.submittedAt).toLocaleString()}</p>
      `;
    }
  } catch (err) {
    console.error('‚ùå Error loading ID request:', err);
    content.innerHTML = '‚ö†Ô∏è Could not load your ID request status.';
  }

  new bootstrap.Modal(document.getElementById('idStatusModalBS')).show();
}

// ================================
// üìå HELPER: STATUS BADGE COLOR
// ================================
function getStatusColor(status) {
  switch ((status || '').toUpperCase()) {
    case 'PENDING': return 'warning';
    case 'ACCEPTED': return 'success';
    case 'ACCEPTED - PENDING': return 'info';
    case 'RELEASING': return 'primary';
    case 'RELEASED': return 'dark';
    case 'DECLINED': return 'danger';
    default: return 'secondary';
  }
}




  
  </script>
</body>
</html>
