<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ADMIN PAGE | TUP - Cavite</title>

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Alegreya:wght@400;500;700&family=Albert+Sans:wght@400;500;700&family=Sanchez&display=swap" rel="stylesheet" />
  <!-- Font Awesome for Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  <!-- Font Awesome for Social Media Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

  <link rel="icon" type="image/png" href="/Logo2.png">


  <!-- External CSS -->
  <link rel="stylesheet" href="admin-homepage.css" />
</head>
<body>
  <div class="adminpage">
    <img class="Navbar" src="Navbar.png" />
    <div class="Line1"></div>
    <div class="Line2"></div>


    <div id="toast-container"></div>

<div class="event-button slide-in" onclick="openModal('modal-event')">
  <div class="content">
    <div class="state-layer">
      <div class="hover-underline1">EVENT</div>
    </div>
  </div>
</div>

<div id="modal-event" class="modal">
  <div class="modal-content">
    <span class="close">&times;</span>
    <form id="eventForm" enctype="multipart/form-data">
      <label for="title">Event Title</label>
      <select id="title" name="title" required>
        <option value="">-- Choose Event --</option>
        <option value="HomeComing">HomeComing Event</option>
        <option value="SportFest">Sport Fest</option>
      </select>

      <label for="location">Set Date, Time & Location</label>
      <input type="text" id="location" name="location" placeholder="e.g. Sept 30, 7PM, Gymnasium" required>

      <!-- ‚úÖ Styled File Upload -->
      <label for="eventImage" class="file-label">Upload Image</label>
      <input type="file" id="eventImage" name="image" accept="image/*" required>

      <label for="description">Description</label>
      <textarea id="description" name="description" rows="3" required></textarea>

      <button type="submit">Publish</button>
    </form>
  </div>
</div>






<!-- CAREER BUTTON -->
<div class="career-button slide-in" onclick="openModal('modal-career')">
  <div class="content">
    <div class="state-layer">
      <div class="hover-underline1">CAREER</div>
    </div>
  </div>
</div>

<div id="modal-career" class="modal">
  <div class="modal-content">
    <span class="close">&times;</span>
    <form id="careerForm" enctype="multipart/form-data">
      <label for="careerType">Career Type</label>
      <select id="careerType" name="title" required>
        <option value="">-- Select Career --</option>
        <option value="Electrician">Electrician</option>
        <option value="Mechanic">Mechanic</option>
        <option value="Education">Education</option>
        <option value="Software Developer">Software Developer</option>
        <option value="Network Engineer">Network Engineer</option>
        <option value="Telecommunications Engineer">Telecommunications Engineer</option>
        <option value="Electrical Engineer">Electrical Engineer</option>
        <option value="Maintenance Engineer / Technician">Maintenance Engineer / Technician</option>
      </select>

      <label for="careerLink">Link</label>
      <input type="text" id="careerLink" name="link" placeholder="https://example.com">

      <!-- ‚úÖ Styled File Upload -->
      <label for="careerImage" class="file-label">Upload Image</label>
      <input type="file" id="careerImage" name="image" accept="image/*" required>

      <label for="careerDesc">Description</label>
      <textarea id="careerDesc" name="description" rows="3" required></textarea>

      <button type="submit">Publish</button>
    </form>
  </div>
</div>



    <div class="gallery-button slide-in" id="galleryBtn">
      <div class="content"><div class="state-layer"><div class="hover-underline1">GALLERY</div></div></div>
    </div>

    <!-- Modal for gallery -->
    <div class="gallery-modal" id="galleryModal">
      <div class="gallery-content">
        <button id="closeGallery" class="gallery-close">&times;</button>
        <h2>Gallery Posting ‚ÄúMax 25 Pictures per post‚Äù </h2>

        <form id="uploadForm" class="upload-form">
          <label>Select Images:</label>
          <input type="file" name="images" multiple accept="image/*" required />
          <button type="submit">Upload Images</button>
        </form>

        <div class="gallery-grid" id="galleryGrid"></div>
      </div>
    </div>

    <button id="signOutBtn" class="sign-out-button slide-in">
      <div class="content"><div class="state-layer"><div class="hover-underline1">SIGN-OUT</div></div></div>
    </button>

    <div id="loader-wrapper">
      <div class="loader-content">
          <span class="loading-span">T</span>
          <span class="loading-span2">ECHNOLOGICAL</span>
          <span class="loading-span">U</span>
          <span class="loading-span2">NIVERSITY OF THE</span>
          <span class="loading-span">P</span>
          <span class="loading-span2">HILIPPINES - </span>
          <span class="loading-span">C</span>
          <span class="loading-span2">AVITE</span>

        <div class="progress-container">
          <div class="progress-bar" id="progress-bar"></div>
        </div>
        <div class="percentage" id="percentage">0%</div>
        <div class="footer-text">LOADING PLEASE WAIT</div>
      </div>
    </div>

    <!-- Edit Button -->
    <button onclick="toggleEdit()" class="gcash-button">GCASH PAYMENT QRCode</button>

    <!-- Image Upload Section -->
    <div id="editSection" style="display: none; margin-top: 10px;">
      <input type="file" id="gcashUpload" accept="image/*" />
      <button onclick="saveImage()" class="save-button">Save</button>
      <button onclick="closeEdit()" class="close-button">Close</button>

      <div id="previewBox" style="margin-top: 10px;"></div>
    </div>


    <a href="admin-homepage.html">
      <img class="Logo" src="Logo.png" alt="University Logo" />
    </a>

    <div class="a-l-u-m-n-i slide-in">
      <span class="a-l-u-m-n-i-span">A</span>
      <span class="a-l-u-m-n-i-span2">l u m n i</span>
      <span class="a-l-u-m-n-i-span">C</span>
      <span class="a-l-u-m-n-i-span2">o o r d i n a t o r</span>
    </div>

    <div class="technological-university-of-the-philippines-cavite">
      TECHNOLOGICAL UNIVERSITY OF THE PHILIPPINES ‚Äì CAVITE
    </div>


    <div class="announcement-box">
      <h3>ID Announcements</h3>
      <div class="announcement-list" id="idAnnouncementList">
        Loading...
      </div>
    </div>

    <div id="confirmModal" class="confirm-modal hidden">
      <div class="confirm-box">
        <p id="confirmMessage">Are you sure?</p>
        <div class="confirm-actions">
          <button id="confirmYes">Yes</button>
          <button id="confirmNo">No</button>
        </div>
      </div>
    </div>

    <div class="announcement-box2">
      <h3>Events Announcements</h3>
      <div class="announcement-list" id="eventList">
        Loading...
      </div>
    </div>

    <div class="career-box">
      <h3>Career Opportunities</h3>
      <div class="career-list" id="careerList">
        Loading...
      </div>
    </div>


<div class="selection-container slide-in">
  <button type="button" class="select-trigger" id="dropdownBtn">
    DATA MANAGEMENT ‚ñæ
  </button>
  <div class="dropdown-menu" id="dropdownMenu">
    <div class="hover-underline1" onclick="navigateTo('alumni-Database.html')">Alumni Database</div>
    <div class="hover-underline1" onclick="navigateTo('jobs-response.html')">Jobs Response</div>
    <div class="hover-underline1" onclick="navigateTo('data-registration.html')">Registration</div>
    <div class="hover-underline1" onclick="navigateTo('admin-id.html')">ID Request</div>
    <div class="hover-underline1" onclick="navigateTo('event-registration.html')">Event Registration</div>
    <div class="hover-underline1" onclick="navigateTo('admin-employer.html')">Employer Registration</div>
  </div>
</div>


  <div id="inboxPanel" class="modern-inbox">
    <div class="inbox-header">Admin Inbox</div>
    <div id="inboxContentList" class="inbox-list"></div>
    <div class="inbox-footer">
      <button id="clearInboxBtn">Clear All</button>
    </div>
  </div>

  <div id="notificationToggle" class="admin-notification-wrapper">
    <i class="fas fa-bell"></i>
    <span id="inboxBadge" class="notif-badge">0</span>
  </div>

  <div id="confirmationModal" class="inbox-confirm-modal hidden">
    <div class="inbox-modal-content">
      <div class="inbox-modal-header">Confirm Clear All</div>
      <div class="inbox-modal-body">Are you sure you want to clear all notifications?</div>
      <div class="inbox-modal-footer">
        <button id="confirmYesBtn" class="inbox-modal-btn yes">Yes</button>
        <button id="confirmNoBtn" class="inbox-modal-btn no">No</button>
      </div>
    </div>
  </div>


  
  <!-- Trigger Button -->
  <div class="id-post-button slide-in" id="idPostBtn">
    <div class="content"><div class="state-layer"><div class="hover-underline1">ID ANNOUNCEMENT</div></div></div>
  </div>

  <!-- Modal -->
  <div id="idPostModal" class="modal">
    <div class="modal-content">
      <span class="close-btn" onclick="closeIDPostModal()">&times;</span>
      <h2 class="modal-title">Post ID Announcement</h2>
      <form id="idPostForm" class="modal-form">
        <label>Title:</label>
        <input type="text" name="title" required>

        <label>Description:</label>
        <textarea name="description" rows="4" required></textarea>

        <button type="submit" class="submit-btn">üì© Post Announcement</button>
      </form>
      <div id="idPostResult" class="result-message"></div>
    </div>
  </div>

  <div id="feed"></div>

  <!-- External JavaScript -->
<!-- Load external scripts -->
<script src="/socket.io/socket.io.js"></script>
<script type="module">
  import { setupSignOut } from './sign-out.js';
  setupSignOut('admin');  // Restrict access to admin
</script>

<!-- Main Application Script -->
<script>
    function toggleEdit() {
      const section = document.getElementById('editSection');
      section.style.display = section.style.display === 'none' ? 'block' : 'none';
    }

    function closeEdit() {
      document.getElementById('editSection').style.display = 'none';
    }

    function saveImage() {
      const file = document.getElementById("gcashUpload").files[0];
      if (!file) return alert("No file selected!");

      const reader = new FileReader();
      reader.onload = () => {
        localStorage.setItem("gcashImage", reader.result);
        document.getElementById("previewBox").innerHTML = `<img src="${reader.result}" style="max-width:200px" />`;
      };
      reader.readAsDataURL(file);
    }
  
document.addEventListener('DOMContentLoaded', () => {
  enforceAdminRole();
  initLoader();
  initDropdown();
  initContactObserver();
  initGallery();
  loadIdAnnouncements();
  loadEvents();
  loadCareers();
  initIDPostModal();
  initNotificationSystem();
});

function enforceAdminRole() {
  if (sessionStorage.getItem('userRole') !== 'admin') {
    window.location.href = 'homepage.html';
  }
}

function navigateTo(url) {
  window.location.href = url;
}

function initLoader() {
  let pct = 80;
  const loader = document.getElementById("loader-wrapper"),
        bar = document.getElementById("progress-bar"),
        pctEl = document.getElementById("percentage");

  const iv = setInterval(() => {
    if (pct < 100) {
      pct++;
      bar.style.width = pct + "%";
      pctEl.textContent = pct + "%";
    } else {
      clearInterval(iv);
      loader.style.display = "none";
    }
  }, 30);
}

function initDropdown() {
  const menu = document.getElementById('dropdownMenu');
  document.querySelector('.select-trigger')?.addEventListener('click', () => {
    menu.classList.toggle('show');
  });

  window.addEventListener('click', e => {
    if (!menu.contains(e.target) && !e.target.closest('.select-trigger')) {
      menu.classList.remove('show');
    }
  });
}

function initContactObserver() {
  const contactSection = document.querySelector('.contact-section');
  if (!contactSection) return;

  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      contactSection.classList.toggle('slide-up', entry.isIntersecting);
      contactSection.classList.toggle('slide-down', !entry.isIntersecting);
    });
  }, { threshold: 0.1 });

  observer.observe(contactSection);
}

// Gallery Logic
function initGallery() {
  const btn = document.getElementById('galleryBtn');
  const modal = document.getElementById('galleryModal');
  const close = document.getElementById('closeGallery');
  const grid = document.getElementById('galleryGrid');
  const form = document.getElementById('uploadForm');

  btn?.addEventListener('click', () => {
    modal.style.display = 'flex';
    loadGallery(grid);
  });
  close?.addEventListener('click', () => modal.style.display = 'none');

  form?.addEventListener('submit', async e => {
    e.preventDefault();
    const fd = new FormData();
    [...form.elements['images'].files].forEach(f => fd.append('images', f));
    if (fd.has('images')) {
      const res = await fetch('/api/gallery/add-multiple', { method: 'POST', body: fd });
      const json = await res.json();
      if (res.ok) {
        form.reset();
        loadGallery(grid);
      } else alert('Upload failed: ' + (json.error || 'Unknown error'));
    } else alert('No images selected');
  });
}

async function loadGallery(container) {
  try {
    const res = await fetch('/api/gallery');
    if (!res.ok) throw new Error(await res.text());
    const { items } = await res.json();

    container.innerHTML = items.map(it => `
      <div class="gallery-item">
        <img src="${it.image}" alt="Gallery image">
        <button onclick="deleteImage(${it.id})">üóëÔ∏è</button>
        <div class="gallery-date">${new Date(it.datePosted).toLocaleString()}</div>
      </div>
    `).join('');
  } catch (err) {
    alert('Failed to load gallery: ' + err.message);
  }
}

async function deleteImage(id) {
  try {
    const res = await fetch(`/api/gallery/${id}`, { method: 'DELETE' });
    if (!res.ok) throw new Error(await res.text());

    showToast("‚úÖ Image deleted successfully!", "success");
    loadGallery(document.getElementById('galleryGrid'));

  } catch (err) {
    console.error("‚ùå Delete error:", err);
    showToast("‚ùå Failed to delete image", "error");
  }
}

// ID Announcements
async function loadIdAnnouncements() {
  const container = document.getElementById('idAnnouncementList');
  container.innerHTML = 'Loading...';
  try {
    const res = await fetch('/api/admin/id-announcements');
    const { announcements } = await res.json();
    container.innerHTML = announcements.length ? announcements.map(a => `
      <div class="event-card" data-id="${a.id}">
        <div class="event-header">
          <span class="badge">ID ANNOUNCEMENT</span>
          <span class="posted-date">Posted: ${new Date(a.datePosted).toLocaleDateString()}</span>
        </div>
        <div class="event-title">${a.title}</div>
        <p>${a.description}</p>
        <button onclick="deleteAnnouncement(${a.id})" class="delete-btn">üóëÔ∏è Delete</button>
      </div>
    `).join('') : '<div>No announcements found.</div>';
  } catch (err) {
    container.innerHTML = '<div class="error">‚ùå Failed to load announcements</div>';
  }
}

async function deleteAnnouncement(id) {
  showConfirm('‚ùó Are you sure you want to delete this announcement?', async () => {
    const res = await fetch(`/api/admin/id-announcement/${id}`, { method: 'DELETE' });
    if (res.ok) {
      document.querySelector(`.event-card[data-id="${id}"]`)?.remove();
      showToast('‚úÖ Deleted!');
    } else {
      showToast('‚ùå Failed to delete.', true);
    }
  });
}

function initIDPostModal() {
  document.getElementById('idPostBtn')?.addEventListener('click', () => {
    document.getElementById('idPostModal').style.display = 'flex';
  });

  document.getElementById('idPostForm')?.addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const formData = new FormData(this);
    const data = Object.fromEntries(formData.entries());
    
    console.log('Form data being sent:', data); // Debug log
    
    // Validate on frontend too
    if (!data.title || !data.description || data.title.trim() === '' || data.description.trim() === '') {
      document.getElementById('idPostResult').textContent = '‚ùå Please fill in all fields';
      return;
    }

    // Show loading state
    const submitBtn = this.querySelector('button[type="submit"]');
    const originalText = submitBtn.textContent;
    submitBtn.textContent = 'Posting...';
    submitBtn.disabled = true;

    try {
      const res = await fetch('/api/admin/id-announcement', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      });

      const result = await res.json();
      
      console.log('Server response:', result); // Debug log
      
      document.getElementById('idPostResult').textContent = res.ok
        ? '‚úÖ Announcement Posted!'
        : `‚ùå Error: ${result.error || 'Failed to post'}`;

      if (res.ok) {
        setTimeout(() => {
          closeIDPostModal();
          loadIdAnnouncements(); // Refresh the announcements list
        }, 2000);
      }
    } catch (error) {
      console.error('Network error:', error);
      document.getElementById('idPostResult').textContent = '‚ùå Network error. Please try again.';
    } finally {
      // Restore button state
      submitBtn.textContent = originalText;
      submitBtn.disabled = false;
    }
  });
}

function closeIDPostModal() {
  document.getElementById('idPostModal').style.display = 'none';
  document.getElementById('idPostForm').reset();
  document.getElementById('idPostResult').textContent = '';
}

// Events & Careers
async function loadEvents() {
  const container = document.getElementById('eventList');
  try {
    const res = await fetch('/api/events');
    const { events } = await res.json();
    container.innerHTML = events.map(e => `
      <div class="event-card">
        <div class="event-header">
          <span class="badge">EVENT ANNOUNCEMENT</span>
          <span class="posted-date">Posted: ${new Date(e.datePosted).toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' })}</span>
        </div>
        <div class="event-title">${e.title}</div>
      </div>
    `).join('') || '<div>No announcements found.</div>';
  } catch {
    container.innerHTML = '<div class="error">‚ùå Failed to load events</div>';
  }
}

async function loadCareers() {
  const listContainer = document.getElementById('careerList');
  try {
    const res = await fetch('/api/careers');
    const { careers } = await res.json();
    listContainer.innerHTML = careers.slice(0, 10).map(c => `
      <div class="career-card">
        <div class="career-header"><span class="career-badge">CAREER</span> Posted: ${new Date(c.datePosted).toLocaleDateString()}</div>
        <div class="career-title">${c.title}</div>
      </div>
    `).join('') || '<div>No announcements found.</div>';
  } catch {
    listContainer.innerHTML = '‚ùå Failed to load careers';
  }
}

// Confirm Dialog
function showConfirm(message, onConfirm) {
  const modal = document.getElementById('confirmModal');
  document.getElementById('confirmMessage').textContent = message;
  modal.classList.remove('hidden');

  document.getElementById('confirmYes').onclick = () => {
    modal.classList.add('hidden');
    onConfirm();
  };
  document.getElementById('confirmNo').onclick = () => {
    modal.classList.add('hidden');
  };
}

// Notification System
function initNotificationSystem() {
  const inboxList = document.getElementById('inboxContentList');
  const badge = document.getElementById('inboxBadge');
  const bell = document.getElementById('notificationToggle');
  const panel = document.getElementById('inboxPanel');
  const clearBtn = document.getElementById('clearInboxBtn');

  bell?.addEventListener('click', () => panel.classList.toggle('show'));

  clearBtn?.addEventListener('click', () => {
    document.getElementById('confirmationModal').classList.remove('hidden');
  });

  document.getElementById('confirmYesBtn').onclick = () => {
    fetch('/api/notifications/clear', { method: 'DELETE' })
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          inboxList.innerHTML = '';
          updateBadge();
        }
        document.getElementById('confirmationModal').classList.add('hidden');
      });
  };

  document.getElementById('confirmNoBtn').onclick = () => {
    document.getElementById('confirmationModal').classList.add('hidden');
  };

  function renderNotification(notif) {
    const item = document.createElement('div');
    item.className = 'inbox-item';
    item.innerHTML = `
      <div class="inbox-item-icon"><i class="fas fa-bell"></i></div>
      <div class="inbox-item-text clickable">
        <div class="inbox-item-title">
          ${notif.name} <span class="inbox-item-time">${new Date(notif.createdAt).toLocaleTimeString()}</span>
        </div>
        <div>${notif.message}</div>
      </div>
    `;
    item.addEventListener('click', () => {
      fetch(`/api/notifications/${notif.id}`, { method: 'DELETE' })
        .then(() => {
          item.remove();
          updateBadge();
          window.location.href = notif.link;
        });
    });
    inboxList.prepend(item);
    updateBadge();
  }

  function updateBadge() {
    const count = inboxList.querySelectorAll('.inbox-item').length;
    badge.textContent = count;
    badge.style.display = count > 0 ? 'inline-block' : 'none';
  }

  fetch('/api/admin/inbox')
    .then(res => res.json())
    .then(data => data.forEach(renderNotification));

  const socket = io();
  socket.on('newNotification', renderNotification);
}


async function loadFeed() {
  const container = document.getElementById('feed');
  container.innerHTML = 'Loading feed...';

  try {
    // Fetch events and careers separately
    const [eventsRes, careersRes] = await Promise.all([
      fetch('/api/events'),
      fetch('/api/careers')
    ]);

    const { events } = await eventsRes.json();
    const { careers } = await careersRes.json();

    // Add "type" field for clarity
    const formattedEvents = events.map(e => ({ ...e, type: 'Event' }));
    const formattedCareers = careers.map(c => ({ ...c, type: 'Career' }));

    // Merge and sort by datePosted (newest first)
    const feed = [...formattedEvents, ...formattedCareers]
      .sort((a, b) => new Date(b.datePosted) - new Date(a.datePosted));

    // Render feed
    container.innerHTML = feed.map(post => {
      let extraInfo = "";
      if (post.type === "Event") {
        extraInfo = `üìç Location: ${post.location || "N/A"}`;
      } else if (post.type === "Career") {
        extraInfo = `üè¢ Company Name: ${post.link || "N/A"}`;
      }

      return `
        <div class="feed-card">
          ${post.image ? `<img class="feed-img" src="${post.image}" alt="">` : ""}
          <div class="feed-content">
            <h2>${post.title} <small>[${post.type}]</small></h2>
            <p>${post.description}</p>
            <small>
              ${extraInfo} <br>
              üïí Posted on: ${new Date(post.datePosted).toLocaleString()}
            </small>
          </div>
        </div>
      `;
    }).join('');

  } catch (err) {
    console.error(err);
    container.textContent = '‚ö†Ô∏è Failed to load feed.';
  }
}

document.addEventListener('DOMContentLoaded', loadFeed);





// ‚úÖ Toast Notification Utility
function showToast(message, type = "info") {
  const container = document.getElementById("toast-container");
  if (!container) return; // in case toast container not in DOM

  const toast = document.createElement("div");
  toast.className = `toast ${type}`;
  toast.textContent = message;

  container.appendChild(toast);

  // Remove after animation
  setTimeout(() => {
    toast.remove();
  }, 4000);
}



// üîπ Reusable modal open/close functions
function openModal(id) {
  const modal = document.getElementById(id);
  if (modal) modal.style.display = "flex";
}

function closeModal(id) {
  const modal = document.getElementById(id);
  if (modal) modal.style.display = "none";
}

document.addEventListener("DOMContentLoaded", () => {
  const userRole = sessionStorage.getItem("userRole"); // ‚úÖ get role

  // ================== EVENT MODAL ==================
  const eventModal = document.getElementById('modal-event');
  const openEventBtn = document.querySelector('.event-button');
  const closeEventBtn = eventModal.querySelector('.close');
  const eventForm = document.getElementById("eventForm");

  // ‚úÖ Open modal
  openEventBtn.addEventListener("click", () => {
    if (userRole !== "admin") {
      showToast("‚ö†Ô∏è Only admins can post events.", "error");
      return;
    }
    eventModal.style.display = "flex";
  });

  // ‚úÖ Close modal
  closeEventBtn.addEventListener("click", () => {
    eventModal.style.display = "none";
  });

  // ‚úÖ Close if clicking outside
  window.addEventListener("click", (e) => {
    if (e.target === eventModal) eventModal.style.display = "none";
  });

  // ‚úÖ Submit Event form
  eventForm.addEventListener("submit", async (e) => {
    e.preventDefault();

    const formData = new FormData(eventForm);

    try {
      const res = await fetch("/api/events/add", {
        method: "POST",
        body: formData
      });

      const data = await res.json();
      if (!res.ok) throw new Error(data.error || "Event creation failed");

      showToast("‚úÖ Event published successfully!", "success");
      eventModal.style.display = "none";
      eventForm.reset();

      // üîÑ Reload only if admin
      if (userRole === "admin") {
        setTimeout(() => location.reload(), 1500);
      }

    } catch (err) {
      console.error("‚ùå Event submission error:", err);
      showToast("‚ùå " + err.message, "error");
    }
  });

  // ================== CAREER MODAL ==================
  const careerModal = document.getElementById('modal-career');
  const openCareerBtn = document.querySelector('.career-button');
  const closeCareerBtn = careerModal.querySelector('.close');
  const careerForm = document.getElementById("careerForm");

  // ‚úÖ Open modal
  openCareerBtn.addEventListener("click", () => {
    if (userRole !== "admin" && userRole !== "employer") {
      showToast("‚ö†Ô∏è Only admins and employers can post careers.", "error");
      return;
    }
    careerModal.style.display = "flex";
  });

  // ‚úÖ Close modal
  closeCareerBtn.addEventListener("click", () => {
    careerModal.style.display = "none";
  });

  // ‚úÖ Close if clicking outside
  window.addEventListener("click", (e) => {
    if (e.target === careerModal) careerModal.style.display = "none";
  });

  // ‚úÖ Submit Career form
  careerForm.addEventListener("submit", async (e) => {
    e.preventDefault();

    const formData = new FormData(careerForm);

    try {
      const res = await fetch("/api/careers/add", {
        method: "POST",
        body: formData
      });

      const data = await res.json();
      if (!res.ok) throw new Error(data.error || "Career post failed");

      showToast("‚úÖ Career published successfully!", "success");
      careerModal.style.display = "none";
      careerForm.reset();

      // üîÑ Reload only if admin OR employer
      if (userRole === "admin" || userRole === "employer") {
        setTimeout(() => location.reload(), 1500);
      }

    } catch (err) {
      console.error("‚ùå Career submission error:", err);
      showToast("‚ùå " + err.message, "error");
    }
  });
});





</script>
</body>
</head>
</html>