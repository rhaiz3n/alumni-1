<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ALUMNI | Registration</title>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Alegreya:wght@400;500;700&family=Albert+Sans:wght@400;500;700&family=Sanchez&display=swap" rel="stylesheet" />

    <!-- External CSS -->
    <link rel="stylesheet" href="alumni-registration.css" />
  </head>
  <body>
    <div class="registrationpage">
      <img class="Navbar" src="Navbar.png" />
      <div class="frame"></div>
      <div class="line1"></div>
      <div class="label1">TECHNOLOGICAL UNIVERSITY OF THE PHILIPPINES ‚Äì CAVITE</div>
      <button class="back-button" onclick="location.href='homepage.html'"><span class="underline-slide">BACK</span></button>

      <img class="Logo" src="Logo2.png" alt="University Logo" />
      <div class="alumni zoom-in" style="animation-delay: 0.2s">
        <span class="alumni-span">A</span>
        <span class="alumni-span2">LUMNI</span>
        <span class="alumni-span">R</span>
        <span class="alumni-span2">EGISTRATION</span>
      </div>

    <div class="reminders slide-in" style="animation-delay: 0.2s">REMINDERS</div>
    <div class="line2 zoom-in" style="animation-delay: 0.2s"></div>
    <div class="reminder slide-in" style="animation-delay: 0.2s">
      Sign up today to receive your personalized Alumni Account.
    </div>

    <div class="notify slide-in" style="animation-delay: 0.2s">
      The system will send an email to this address once your registration confirmation has been successfully reviewed for your Alumni Account.
    </div>

    <div class="consents slide-in" style="animation-delay: 0.2s">
      Your information will be reviewed, and we will notify you once your account is ready.
      The details you provide will also be used to update your records with the TUP-Cavite System Office of Alumni Relations.
      <br><br>
      <strong>Important Instructions</strong><br>
      Please ensure that the information you submit matches the University's records to prevent delays or issues in processing your registration.
      <br><br>
      Once you have submitted your details, the system will review them. After verification, you will receive a notification regarding the status of your registration and the successful creation of your account.
      <br><br>
      All personal information submitted during registration will be securely stored and managed by the TUP-Cavite System Office of Alumni Relations. Your data will remain confidential and will not be shared with external parties, ensuring full respect for your privacy rights.
    </div>

    <div class="line3 zoom-in" style="animation-delay: 0.2s"></div>
    <div class="line4 zoom-in" style="animation-delay: 0.2s"></div>
    <div class="line5 zoom-in" style="animation-delay: 0.2s"></div>
    <div class="line6 zoom-in" style="animation-delay: 0.2s"></div>
    <div class="about-yourself slide-in" style="animation-delay: 0.2s">ABOUT YOURSELF</div>
    <div class="certificate slide-in" style="animation-delay: 0.2s">YOUR MOST RECENT UP DEGREE/CERTIFICATE</div>
    <div class="personal slide-in" style="animation-delay: 0.2s">PERSONAL CONTACT INFORMATION</div>
    <div class="alumnir1 slide-in" style="animation-delay: 0.2s">Alumni User Registration</div>
    <div class="alumnir2 slide-in" style="animation-delay: 0.2s">Technological University of the Philippines - Cavite</div>


    <form id="regForm">

      <!-- First Name -->
      <div class="first-name slide-in">
        First Name <span class="required-star">*</span>
      </div>
      <div class="first-name-typebox slide-in">
        <input 
          type="text" 
          class="firstname-typebox" 
          name="firstName" 
          placeholder="First Name" 
          maxlength="25" 
          required 
          oninput="this.value = formatName(this.value)" 
        />
      </div>

      <div class="last-name slide-in">
        Last Name <span class="required-star">*</span>
      </div>
      <div class="last-name-typebox slide-in">
        <input 
          type="text" 
          class="lastname-typebox" 
          name="lastName" 
          placeholder="Last Name" 
          maxlength="25" 
          required 
          oninput="this.value = formatName(this.value)" 
        />
      </div>

        <!-- Initial -->
      <div class="initial-name slide-in">
        Initial <span class="required-star">*</span>
      </div>
      <div class="initial-name-typebox slide-in">
        <input 
          type="text" 
          class="initialname-typebox" 
          name="initial" 
          placeholder="Initial" 
          maxlength="1" 
          required 
          oninput="this.value = this.value.replace(/[^a-zA-Z]/g, '').toUpperCase()" 
        />
      </div>


      <!-- Username -->
      <div class="user-name slide-in">
        Username <span class="required-star">*</span>
      </div>
      <div class="user-name-typebox slide-in">
        <input 
          type="text" 
          class="username-typebox" 
          name="userName" 
          placeholder="Enter Username" 
          maxlength="25" 
          required 
          oninput="limitUsernameDigits(this)" 
        />
      </div>


      <!-- Major -->
      <div class="degree slide-in">Course & Major.[BET-COET/BTVTED-ET] <span class="required-star">*</span></div>
      <div class="degree-typebox slide-in">
        <input 
          type="text" 
          class="degrees-typebox" 
          name="major" 
          placeholder="Course & Major." 
          maxlength="9" 
          required 
          oninput="formatMajor(this)" 
        />
      </div>


      <!-- Personal Email -->
      <div class="personalEmail slide-in" style="animation-delay: 0.2s">
        Personal Email Address <span class="required-star">*</span>
      </div>
      <div class="personale-typebox slide-in" style="animation-delay: 0.2s">
        <input 
          type="email" 
          class="personales-typebox" 
          name="personalEmail" 
          id="personalEmail" 
          placeholder="Personal Email Address" 
          maxlength="50" 
          required 
          oninput="
            this.value = this.value.replace(/\s/g, '');
            document.getElementById('retypeEmail').value = this.value;
          " 
        />
      </div>

      <!-- Retype Email -->
      <div class="retype slide-in" style="animation-delay: 0.2s"> Email Address <span class="required-star">*</span>
      </div>
      <div class="retypee-typebox slide-in" style="animation-delay: 0.2s">
        <input 
          type="text" 
          class="retypees-typebox" 
          placeholder="Email Address" 
          id="retypeEmail" 
          maxlength="50" 
          required 
          readonly 
        />
      </div>


      <!-- Year Started -->
      <div class="year slide-in">Year Started <span class="required-star">*</span></div>
      <div class="year-typebox slide-in">
        <select id="year-started" class="years-typebox" name="yearStarted" required>
          <option value="" disabled selected hidden>Select Year</option>
          <!-- You can populate this with JS -->
        </select>
      </div>

      <!-- Year Graduated -->
      <div class="yearg slide-in">Graduated <span class="required-star">*</span></div>
      <div class="yearg-typebox slide-in">
        <select id="year-graduated" class="yearg-typebox1" name="graduated" required>
          <option value="" disabled selected hidden>Select Year Graduated</option>
        </select>
      </div>

      <!-- Password -->
      <label class="passWords slide-in">Password <span class="required-star">*</span></label>
      <div class="password-wrapper slide-in">
        <input 
          type="password" 
          id="password" 
          class="password-input" 
          name="passWord" 
          placeholder="Enter Password" 
          maxlength="20" 
          minlength="10"
          required 
          oninput="this.value = this.value.replace(/[^a-zA-Z0-9]/g, '')" 
        />
        <span id="togglePassword" class="toggle-password">‚òê</span>
        <small id="passwordHelp" class="password-error">Password must be at least 10 characters</small>
      </div>


      <!-- Phone Number -->
      <div class="phone-number slide-in" style="animation-delay: 0.2s">
        Phone No. <span class="required-star">*</span>
      </div>
      <div class="phone-number-typebox slide-in" style="animation-delay: 0.2s">
        <input 
          type="tel" 
          class="phonenumber-typebox" 
          placeholder="Phone No." 
          name="phoneNo"
          maxlength="12"
          pattern="\d{13}"
          inputmode="numeric"
          required
          oninput="this.value = this.value.replace(/[^0-9]/g, '')"
        />
      </div>


      <!-- Full name -->
      <div class="maiden-name slide-in" style="animation-delay: 0.2s">
        Maiden Name <span class="required">*</span>
      </div>
      <div class="maiden-name-typebox slide-in" style="animation-delay: 0.2s">
        <input 
          type="text" 
          class="maidenname-typebox" 
          placeholder="Maiden Name" 
          name="maiden" 
          maxlength="15" 
          required 
          oninput="this.value = formatName(this.value)" 
        />
      </div>


      <!-- Loading Screen -->
      <div id="loader-wrapper">
        <div class="loader-content">
            <span class="loading-span">T</span>
            <span class="loading-span2">ECHNOLOGICAL</span>
            <span class="loading-span">U</span>
            <span class="loading-span2">NIVERSITY OF THE</span>
            <span class="loading-span">P</span>
            <span class="loading-span2">HILIPPINES - </span>
            <span class="loading-span">C</span>
            <span class="loading-span2">AVITE</span>

          <div class="progress-container">
            <div class="progress-bar" id="progress-bar"></div>
          </div>
          <div class="percentage" id="percentage">0%</div>
          <div class="footer-text">LOADING PLEASE WAIT</div>
        </div>
      </div>

      <!-- Gender -->
      <div class="gender slide-in" style="animation-delay: 0.2s">Gender <span class="required-star">*</span></div>
      <select name="gender" id="gender" required class="slide-in" style="animation-delay: 0.2s">
        <option value="" disabled selected hidden>Select Gender</option>
        <option value="MALE">MALE</option>
        <option value="FEMALE">FEMALE</option>
        <option value="TRANSFORMER">Other.</option>
      </select>

      <!-- Civil Status -->
      <div class="civil-status slide-in" style="animation-delay: 0.2s">Civil Status <span class="required-star">*</span></div>
      <select name="civilStatus" id="civilStatus" required class="slide-in" style="animation-delay: 0.2s">
        <option value="" disabled selected hidden>Select Civil Status</option>
        <option value="SINGLE">SINGLE</option>
        <option value="MARRIED">MARRIED</option>
        <option value="SEPARATED">SEPARATED</option>
        <option value="WIDOWED">WIDOWED</option>
        <option value="Divorced">DIVORCED</option>
      </select>

      <!-- Suffix Section -->
      <label class="label-suffix slide-in" style="animation-delay: 0.2s">
        <input type="checkbox" id="toggleSuffix" />
        My name does not end with a suffix. (e.g., Jr, Sr, I, II, etc.)
      </label>

      <div class="suffix-name slide-in" style="animation-delay: 0.2s">
        Suffix <span class="required">*</span>
      </div>
      <div class="suffix-typebox slide-in" style="animation-delay: 0.2s" id="suffixBox">
      <input 
        type="text" 
        class="suffix" 
        placeholder="Suffix" 
        name="suffix" 
        maxlength="3" 
        required 
        oninput="this.value = formatsuffix(this.value)" 
      />
      </div>



      <!-- Student Number Section -->
      <label class="label-student slide-in" style="animation-delay: 0.2s">
        <input type="checkbox" id="toggleStudentNo" />
        My Student No. is no longer available
      </label>

      <div class="student-no slide-in" style="animation-delay: 0.2s">
        Student No. (0123) <span class="required">*</span>
      </div>
      <div class="student-no-typebox slide-in" style="animation-delay: 0.2s" id="studentNoBox">
        <input 
          type="text" 
          class="student" 
          placeholder="Student No." 
          name="studentNo" 
          maxlength="4" 
          required 
          oninput="this.value = this.value.replace(/[^0-9]/g, '')" 
        />
      </div>


      <!-- Consent Button Trigger -->
      <div class="consent-wrapper">
        <input type="checkbox" id="consentCheckbox" />
        <button type="button" class="check-button" onclick="openConsentModal()">
          <span class="hover-underline1">
            <span class="highlight-text">I understand and agree</span> that by clicking the Register submit button below I am deemed to have read, understood, and signed this certification and data privacy consent form.
          </span>
        </button>
      </div>

      <!-- MODAL -->
      <div id="consentModal" class="modal">
        <div class="modal-content">
          
          <!-- Modal Header -->
          <div class="modal-header">
            <img src="Logo2.png" alt="TUP Logo" class="modal-logo5" />
            <div class="modal-title-wrapper">
              <h2>TECHNOLOGICAL UNIVERSITY OF THE PHILIPPINES ‚Äì CAVITE</h2>
              <h3 class="modal-subtitle"><span class="highlight-red">Consent Form</span></h3>
            </div>
            <button class="modal-close" onclick="closeConsentModal()">√ó</button>
          </div>

          <!-- Modal Body -->
          <div class="modal-body">
            <h4>CERTIFICATION AND DATA PRIVACY CONSENT FORM<br>FOR TECHNOLOGICAL UNIVERSITY OF THE PHILIPPINES ‚Äì CAVITE ALUMNI USER REGISTRATION</h4>
            
            <h5>I. CERTIFICATION</h5>
            <ol>
              <li>I am an Alumnus/Alumna of the Technological University of the Philippines - Cavite, and the information provided in this registration form is accurate, true and complete to the best of my knowledge.</li>
              <li>I acknowledge that only one Alumni User Account will be issued per Alumnus/Alumna, and I agree not to request additional accounts or share my login details with any unauthorized person.</li>
              <li>I accept responsibility for the proper use of the User Account and will notify the TUP-Cavite Office of Alumni Relations immediately in case of any issues or discrepancies with my Account.</li>
            </ol>

            <h5>II. DATA PRIVACY CONSENT</h5>
            <ol start="5">
              <li>In compliance with the Data Privacy Act of 2012 (Republic Act No. 10173), I consent to the collection, storage and processing of my personal data provided for my Alumni User registration by the TUP-Cavite Office of Alumni Relations. I understand and agree to the following:</li>
              <li>The Personal Information provided in this form will be securely stored and processed for the purpose of issuing and managing my Alumni User Account.</li>
              <li>My Data will be used exclusively for Alumni communication, verification of my Alumni Status, and updates regarding Alumni programs, events and other relevant University Activities.</li>
              <li>I grant consent for the TUP-Cavite System to Process the following personal data for the purpose of my Alumni User registration.</li>
              <li>I understand that my personal data will be kept confidential and will not be shared with third parties without my consent, except where required by law or University policy.</li>
              <li>I have the right to access, correct and withdraw my consent concerning the processing of my personal Data at any time by contacting the TUP-Cavite Office of Alumni Relations.</li>
              <li>I acknowledge that the TUP-Cavite Alumni User is a privilege and that any false information provided may result in the suspension or deactivation of my account without prior notice.</li>
              <li>I accept that TUP-Cavite is not liable for any issues related to the discontinuation of this service or any other problems associated with the provision of the Alumni User service.</li>
            </ol>
          </div>
        </div>
      </div>

      <!-- Date of Birth -->
      <div class="dob-container" name="dateBirth">
        <div class="dob-label slide-in" style="animation-delay: 0.2s">Date of Birth<span class="required-star">*</span>
        </div>
        <div class="dob-selects">
          <select id="dob-day" name="dob-day" required class="slide-in" style="animation-delay: 0.2s">
            <option value="" disabled selected hidden>Day</option>
          </select>

          <select id="dob-month" name="dob-month" required class="slide-in" style="animation-delay: 0.2s">
            <option value="" disabled selected hidden>Month</option>
            <option value="January">January</option>
            <option value="February">February</option>
            <option value="March">March</option>
            <option value="April">April</option>
            <option value="May">May</option>
            <option value="June">June</option>
            <option value="July">July</option>
            <option value="August">August</option>
            <option value="September">September</option>
            <option value="October">October</option>
            <option value="November">November</option>
            <option value="December">December</option>
          </select>

          <select id="dob-year" name="dob-year" required class="slide-in" style="animation-delay: 0.2s">
            <option value="" disabled selected hidden>Year</option>
          </select>
        </div>
      </div>
    <!-- Warning Toast -->
    <div class="toast-overlay" id="warnOverlay"></div>
    <div class="toast-warning" id="warnToast">
      <div class="toast-header warn">
        <img src="Logo2.png" alt="Logo" class="toast-logo">
        <span class="toast-title">TUP-Cavite Alert</span>
      </div>
      <div class="toast-content" id="warnContent">
        <!-- JS will inject missing field list here -->
      </div>
    </div> 
      <!-- Submit Button -->
    <button id="submitform" type="button" class="submitform-button">Submit</button>
      <!-- Notification -->
        <div id="successToast" class="toast-notification">
          <div class="toast-message">
            <strong>‚úÖ Registration Complete!</strong><br>
            Your application is under review. You will receive an email once your alumni account is approved.
          </div>
        </div>
      </div>
    </form>

    <div id="errorToast" class="toast-notification" style="background-color: #e74c3c;">
      <div class="toast-message" id="errorToastMessage">
        ‚ùå An error occurred. Please try again.
      </div>
    </div>

    <div id="notifyBox" class="notify-popup" style="display: none;"></div>

  <!-- JavaScript -->
<script>

function openConsentModal() {
  document.getElementById('consentModal').style.display = 'flex';
}

function closeConsentModal() {
  document.getElementById('consentModal').style.display = 'none';
}

function formatMajor(input) {
  let value = input.value.toUpperCase();

  // Remove all characters except letters and hyphens
  value = value.replace(/[^A-Z\-]/g, '');

  // Allow only the first hyphen, remove any others
  const firstDash = value.indexOf('-');
  if (firstDash !== -1) {
    // Keep only the first dash and remove any additional dashes
    const beforeDash = value.slice(0, firstDash + 1);
    const afterDash = value.slice(firstDash + 1).replace(/-/g, '');
    value = beforeDash + afterDash;
  }

  // Limit to 9 characters total
  input.value = value.slice(0, 9);
}

function formatName(value) {
  // Keep only letters and spaces
  value = value.replace(/[^a-zA-Z\s]/g, '');
  // Capitalize first letter of each word
  return value.replace(/\b\w/g, char => char.toUpperCase());
}

function formatsuffix(value) {
  // Remove non-letter characters
  value = value.replace(/[^a-zA-Z]/g, '');

  // Normalize case
  const upperValue = value.toUpperCase();

  // List of valid Roman numeral suffixes
  const validSuffixes = ['I', 'II', 'III', 'IV', 'V', 'VI', 'VII', 'VIII', 'IX', 'X'];

  // If it's a known Roman numeral suffix, return it in full caps
  if (validSuffixes.includes(upperValue)) {
    return upperValue;
  }

  // Otherwise, capitalize first letter only (e.g., Jr, Sr)
  return value.charAt(0).toUpperCase() + value.slice(1).toLowerCase();
}


function limitUsernameDigits(input) {
  let value = input.value;

  // Keep only letters, numbers, and dots
  value = value.replace(/[^a-zA-Z0-9.]/g, '');

  // Limit to only one dot
  const firstDotIndex = value.indexOf('.');
  if (firstDotIndex !== -1) {
    // Remove all other dots except the first one
    value = value.slice(0, firstDotIndex + 1) + value.slice(firstDotIndex + 1).replace(/\./g, '');
  }

  // Count digits
  const digits = (value.match(/\d/g) || []).length;

  if (digits <= 2) {
    input.value = value;
  } else {
    // Allow only the first 2 digits, preserving letters and 1 dot
    let digitCount = 0;
    input.value = value
      .split('')
      .filter((char, i) => {
        if (/\d/.test(char)) {
          digitCount++;
          return digitCount <= 2;
        }
        return true;
      })
      .join('');
  }
}


// --- Suffix & Student No. Checkboxes ---
const toggleSuffix = document.getElementById('toggleSuffix');
const suffixInput = document.querySelector('#suffixBox input');
toggleSuffix.addEventListener('change', () => {
  suffixInput.disabled = toggleSuffix.checked;
});

const toggleStudentNo = document.getElementById('toggleStudentNo');
const studentInput = document.querySelector('#studentNoBox input');
toggleStudentNo.addEventListener('change', () => {
  studentInput.disabled = toggleStudentNo.checked;
});

// --- Maiden Name Logic Based on Gender + Civil Status ---
const gender = document.getElementById('gender');
const civilStatus = document.getElementById('civilStatus');
const maidenInput = document.querySelector('[name="maiden"]');

function updateMaidenVisibility() {
  const isFemale = gender.value === 'FEMALE';
  const needsMaiden = ['MARRIED', 'SEPARATED', 'WIDOWED'].includes(civilStatus.value);
  maidenInput.disabled = !(isFemale && needsMaiden);
}
gender.addEventListener('change', updateMaidenVisibility);
civilStatus.addEventListener('change', updateMaidenVisibility);

// --- DOB Day + Year Populate ---
const daySelect = document.getElementById("dob-day");
for (let i = 1; i <= 31; i++) {
  const opt = document.createElement("option");
  opt.value = opt.textContent = i;
  daySelect.appendChild(opt);
}

const yearSelect = document.getElementById("dob-year");
const currentYear = new Date().getFullYear();
for (let y = currentYear; y >= 1900; y--) {
  const opt = document.createElement("option");
  opt.value = opt.textContent = y;
  yearSelect.appendChild(opt);
}

// --- Year Started / Graduated ---
const yearStartedSelect = document.getElementById('year-started');
const yearGraduatedSelect = document.getElementById('year-graduated');
for (let y = currentYear; y >= 1900; y--) {
  const opt1 = document.createElement('option');
  const opt2 = document.createElement('option');
  opt1.value = opt2.value = y;
  opt1.textContent = opt2.textContent = y;
  yearStartedSelect.appendChild(opt1);
  yearGraduatedSelect.appendChild(opt2);
}

// --- Password Visibility Toggle + Minimum Length Validation ---
const passwordInput = document.getElementById('password');
const togglePassword = document.getElementById('togglePassword');
const passwordHelp = document.getElementById('passwordHelp');

// Toggle visibility
togglePassword.addEventListener('click', () => {
  const isPassword = passwordInput.type === 'password';
  passwordInput.type = isPassword ? 'text' : 'password';
  togglePassword.textContent = isPassword ? 'üóπ' : '‚òê';
});

// Validate minimum length
passwordInput.addEventListener('input', () => {
  if (passwordInput.value.length < 10) {
    passwordHelp.style.display = 'inline';
  } else {
    passwordHelp.style.display = 'none';
  }
});

// --- Loader Animation ---
document.addEventListener("DOMContentLoaded", () => {
  let percentage = 80;
  const loaderWrapper = document.getElementById("loader-wrapper");
  const progressBar = document.getElementById("progress-bar");
  const percentageText = document.getElementById("percentage");
  
  if (loaderWrapper && progressBar && percentageText) {
    const loadingInterval = setInterval(() => {
      if (percentage < 100) {
        percentage++;
        progressBar.style.width = percentage + "%";
        percentageText.textContent = percentage + "%";
      } else {
        clearInterval(loadingInterval);
        loaderWrapper.style.display = "none";
      }
    }, 30);
  }
});

// Toast Error Function (Global)
function showErrorToast(msg) {
  const errorToast = document.getElementById('errorToast');
  const errorToastMessage = document.getElementById('errorToastMessage');
  if (errorToast && errorToastMessage) {
    errorToastMessage.innerHTML = ' ' + msg;
    errorToast.classList.add('show');
    setTimeout(() => {
      errorToast.classList.remove('show');
    }, 3000);
  } else {
    console.error(msg);
    alert(msg); // Fallback
  }
}

async function submitregForm() {
  const f = document.getElementById('regForm');
  
  // Validate form exists
  if (!f) {
    showErrorToast('‚ùå Form not found');
    return;
  }

  const dobDay = document.getElementById('dob-day').value;
  const dobMonth = document.getElementById('dob-month').value;
  const dobYear = document.getElementById('dob-year').value;
  
  // FIXED: Ensure proper date format YYYY-MM-DD
  const dateBirth = `${dobYear}-${dobMonth.padStart(2, '0')}-${dobDay.padStart(2, '0')}`;

  const suffix = document.getElementById('toggleSuffix').checked ? 'NONE' : f.suffix.value.trim();
  const studentNo = document.getElementById('toggleStudentNo').checked ? 'NONE' : f.studentNo.value.trim();

  const gender = f.gender.value;
  const civilStatus = f.civilStatus.value;
  const maidenNeeded = (gender === 'FEMALE' && ['MARRIED', 'SEPARATED', 'WIDOWED'].includes(civilStatus));
  const maiden = maidenNeeded ? f.maiden.value.trim() : 'NONE';

  const payload = {
    firstName: f.firstName.value.trim(),
    lastName: f.lastName.value.trim(),
    personalEmail: f.personalEmail.value.trim(),
    userName: f.userName.value.trim(),
    passWord: f.passWord.value.trim(),
    initial: f.initial.value.trim(),
    suffix,
    gender,
    civilStatus,
    dateBirth, // This should now be in YYYY-MM-DD format
    maiden,
    phoneNo: f.phoneNo.value.trim(),
    major: f.major.value.trim(),
    yearStarted: f.yearStarted.value,
    graduated: f.graduated.value,
    studentNo
  };

  console.log('Date birth formatted:', dateBirth); // Debug log
  console.log('Full payload:', payload); // Debug log


  const missing = [];
  for (const [key, val] of Object.entries(payload)) {
    if (!val || val === '') missing.push(key);
  }

  if (missing.length > 0) {
    const msg = `‚ö†Ô∏è Please fill out the following fields:\n\n‚Ä¢ ${missing.join('\n‚Ä¢ ')}`;
    const warnContent = document.getElementById('warnContent');
    const warnOverlay = document.getElementById('warnOverlay');
    const warnToast = document.getElementById('warnToast');
    
    if (warnContent && warnOverlay && warnToast) {
      warnContent.textContent = msg;
      warnOverlay.classList.add('show');
      warnToast.classList.add('show');
      setTimeout(() => {
        warnOverlay.classList.remove('show');
        warnToast.classList.remove('show');
      }, 3000);
    } else {
      showErrorToast(`Please fill: ${missing.join(', ')}`);
    }
    return;
  }

  // ‚úÖ Check if userName ends with ".alumni"
  if (!payload.userName.endsWith('.alumni')) {
    showErrorToast('‚ùó Preferred Username must end with ".alumni"');
    return;
  }

  // Disable submit button during processing
  const submitBtn = document.getElementById('submitform');
  const originalText = submitBtn.textContent;
  submitBtn.textContent = 'Submitting...';
  submitBtn.disabled = true;

  try {
    console.log('Sending registration data:', {
      firstName: payload.firstName,
      lastName: payload.lastName,
      personalEmail: payload.personalEmail,
      gender: payload.gender,
      userName: payload.userName,
      passWord: payload.passWord,
      major: payload.major,
      graduated: payload.graduated
    });

    // First API call - registration
    const res = await fetch('/api/registration/add', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        firstName: payload.firstName,
        lastName: payload.lastName,
        personalEmail: payload.personalEmail,
        gender: payload.gender,
        userName: payload.userName,
        passWord: payload.passWord,
        major: payload.major,
        graduated: payload.graduated
      })
    });

    const data = await res.json();
    if (!res.ok) throw new Error(data.error || 'Registration failed');

    console.log('Registration successful, sending full information...');

    // Second API call - full information
    const res2 = await fetch('/api/fullInformation/add', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    });

    const data2 = await res2.json();
    if (!res2.ok) {
      console.warn('Full information save failed:', data2.error);
      // Don't throw error, registration was successful
    }

    // Show success
    const successToast = document.getElementById('successToast');
    if (successToast) {
      successToast.classList.add('show');
      setTimeout(() => {
        successToast.classList.remove('show');
        window.location.href = 'homepage.html';
      }, 3000);
    } else {
      alert('‚úÖ Registration successful! Redirecting...');
      setTimeout(() => {
        window.location.href = 'homepage.html';
      }, 2000);
    }

    // Reset form
    f.reset();

  } catch (err) {
    console.error('‚ùå Submission failed:', err);
    showErrorToast(err.message || 'Registration failed. Please try again.');
  } finally {
    // Re-enable submit button
    submitBtn.textContent = originalText;
    submitBtn.disabled = false;
  }
}

document.getElementById('submitform').addEventListener('click', (e) => {
  e.preventDefault();

  const consentCheckbox = document.getElementById('consentCheckbox');
  if (!consentCheckbox.checked) {
    showErrorToast('‚ö†Ô∏è Please read the consent form and check the box to proceed.');
    return;
  }

  submitregForm();
});

function showToast(message, type = 'success') {
  const toast = document.getElementById('toast');
  const toastMessage = document.getElementById('toastMessage');
  if (toast && toastMessage) {
    toastMessage.textContent = message;
    toast.className = `toast show ${type}`;
  }
}

document.getElementById('toastCloseBtn').addEventListener('click', () => {
  const toast = document.getElementById('toast');
  if (toast) {
    toast.className = 'toast';
  }
});
</script>
</body>
</html>
